<!doctype html><html lang=en dir=ltr data-theme=light><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=theme-color content="#e74c3c"><meta name=format-detection content="telephone=no"><meta name=robots content="index,follow"><meta name=description content="A Python implementation of the particle filter with systematic, residual, and stratified resampling, demonstrated on a nonlinear state estimation problem."><meta name=author content="yuhi-sa"><link rel=canonical href=https://yuhi-sa.github.io/en/posts/20260223_particle_filter/1/><meta property="og:type" content="article"><meta property="og:title" content="Particle Filter Python Implementation: Comparing Resampling Methods"><meta property="og:description" content="A Python implementation of the particle filter with systematic, residual, and stratified resampling, demonstrated on a nonlinear state estimation problem."><meta property="og:url" content="https://yuhi-sa.github.io/en/posts/20260223_particle_filter/1/"><meta property="og:site_name" content="tomato blog"><meta property="og:locale" content="en"><meta property="og:image" content="https://yuhi-sa.github.io/ogp.jpeg"><meta property="og:image:width" content="1200"><meta property="og:image:height" content="630"><meta property="article:published_time" content="2026-02-23T12:00:00+09:00"><meta property="article:modified_time" content="2026-02-23T15:42:19+09:00"><meta property="article:tag" content="Filtering"><meta property="article:tag" content="Python"><meta property="article:tag" content="Monte Carlo Method"><meta property="article:section" content="posts"><meta name=twitter:card content="summary_large_image"><meta name=twitter:title content="Particle Filter Python Implementation: Comparing Resampling Methods"><meta name=twitter:description content="A Python implementation of the particle filter with systematic, residual, and stratified resampling, demonstrated on a nonlinear state estimation problem."><meta name=twitter:image content="https://yuhi-sa.github.io/ogp.jpeg"><title>Particle Filter Python Implementation: Comparing Resampling Methods | tomato blog</title><link rel=preconnect href=https://fonts.googleapis.com><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=preconnect href=https://cdn.jsdelivr.net crossorigin><link rel=preconnect href=https://pagead2.googlesyndication.com crossorigin><link rel=dns-prefetch href=https://pagead2.googlesyndication.com><link rel=icon href=https://yuhi-sa.github.io/favicon.ico><link rel=alternate hreflang=ja href=https://yuhi-sa.github.io/posts/20260223_particle_filter/1/><link rel=alternate hreflang=en href=https://yuhi-sa.github.io/en/posts/20260223_particle_filter/1/><link rel=alternate hreflang=x-default href=https://yuhi-sa.github.io/en/posts/20260223_particle_filter/1/><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Particle Filter Python Implementation: Comparing Resampling Methods","description":"A Python implementation of the particle filter with systematic, residual, and stratified resampling, demonstrated on a nonlinear state estimation problem.","author":{"@type":"Person","name":"yuhi-sa","url":"https:\/\/yuhi-sa.github.io\/"},"publisher":{"@type":"Organization","name":"tomato blog","logo":{"@type":"ImageObject","url":"https:\/\/yuhi-sa.github.io\/ogp.jpeg"},"url":"https:\/\/yuhi-sa.github.io\/"},"datePublished":"2026-02-23T12:00:00\u002b09:00","dateModified":"2026-02-23T15:42:19\u002b09:00","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/yuhi-sa.github.io\/en\/posts\/20260223_particle_filter\/1\/"},"url":"https:\/\/yuhi-sa.github.io\/en\/posts\/20260223_particle_filter\/1\/","wordCount":1453,"keywords":["Filtering","Python","Monte Carlo Method"],"articleSection":"Posts","inLanguage":"en","timeRequired":"PT7M"}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"tomato blog","item":"https:\/\/yuhi-sa.github.io\/en\/"},{"@type":"ListItem","position":2,"name":"Posts","item":"https:\/\/yuhi-sa.github.io\/en\/posts\/"},{"@type":"ListItem","position":3,"name":"Particle Filter Python Implementation: Comparing Resampling Methods"}]}</script><link rel=preconnect href=https://fonts.googleapis.com><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel=stylesheet><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css integrity="sha512-iecdLmaskl7CVkqkXNQ/ZH/XLlvWZOJyj7Yy7tcenmpD1ypASozpmT/E0iPtmFIB46ZmdtAc9eNBvH0H/ZpiBw==" crossorigin=anonymous referrerpolicy=no-referrer><link href=https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css rel=stylesheet integrity=sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH crossorigin=anonymous><link rel=stylesheet href=/css/variables.min.72a177faa7b12de55dcc39c4ab6b6392116718d5e2735dab0214511354ecb973.css integrity="sha256-cqF3+qexLeVdzDnEq2tjkhFnGNXic12rAhRRE1TsuXM=" crossorigin=anonymous><link rel=stylesheet href=/css/main.min.403a82b29e94ee6e7a39204b5082cdf8b4966cfb44115390da7d8867a5006acd.css integrity="sha256-QDqCsp6U7m56OSBLUILN+LSWbPtEEVOQ2n2IZ6UAas0=" crossorigin=anonymous><link rel=stylesheet href=/css/syntax.min.e379066489e20d5433ca35ac1f468fd9e8859705a62d77a79bb7379ac3613848.css integrity="sha256-43kGZIniDVQzyjWsH0aP2eiFlwWmLXenm7c3msNhOEg=" crossorigin=anonymous><style>body{font-family:-apple-system,BlinkMacSystemFont,inter,segoe ui,Roboto,sans-serif;line-height:1.5;color:#000;background:#fff}[data-theme=dark] body{color:#fff;background:#000}.container{max-width:768px;margin:0 auto;padding:0 1rem}</style><script src=https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js integrity=sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz crossorigin=anonymous defer></script><script src=/js/dark-mode.min.3e457dc8346f064bee795e6f9b73e1516dcd059e750c521fe4b445f9ea9a7821.js integrity="sha256-PkV9yDRvBkvueV5vm3PhUW3NBZ51DFIf5LRF+eqaeCE=" defer></script><script>window.addEventListener("load",function(){const e=document.createElement("script");e.async=!0,e.src="https://www.googletagmanager.com/gtag/js?id=G-LN6QP6VVM3",document.head.appendChild(e),e.onload=function(){window.dataLayer=window.dataLayer||[];function e(){dataLayer.push(arguments)}e("js",new Date),e("config","G-LN6QP6VVM3")}})</script><script>window.MathJax={tex:{inlineMath:[["\\(","\\)"]],displayMath:[["\\[","\\]"]],processEscapes:!0,processEnvironments:!0},options:{skipHtmlTags:["script","noscript","style","textarea","pre","code"],ignoreHtmlClass:"tex2jax_ignore",processHtmlClass:"tex2jax_process"}}</script><script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js id=mathjax-script async></script></head><body itemscope itemtype=https://schema.org/WebPage class=theme-tomatohugo><a href=#main-content class="skip-link sr-only sr-only-focusable" aria-label="Skip to main content">Skip to main content</a><header role=banner class=site-header><nav class="navbar navbar-expand-lg navbar-light bg-light" role=navigation aria-label="Main navigation"><div class=container><a class=navbar-brand href=https://yuhi-sa.github.io/ aria-label="Return to tomato blog homepage">tomato blog
</a><button class="navbar-toggler d-lg-none" type=button data-bs-toggle=collapse data-bs-target=#navbarNav aria-controls=navbarNav aria-expanded=false aria-label="Toggle navigation menu">
<span class=navbar-toggler-icon></span></button><div class="collapse navbar-collapse" id=navbarNav><ul class="navbar-nav ms-auto" role=menubar><li class=nav-item role=none><a class=nav-link href=https://yuhi-sa.github.io/en/ role=menuitem aria-label="Navigate to Blog">Blog</a></li><li class=nav-item role=none><a class=nav-link href=https://yuhi-sa.github.io/en/tags/ role=menuitem aria-label="Navigate to Tags">Tags</a></li><li class=nav-item role=none><a class=nav-link href=https://yuhi-sa.github.io/en/posts/about/ role=menuitem aria-label="Navigate to About">About</a></li><li class=nav-item role=none><a class=nav-link href=https://yuhi-sa.github.io/en/posts/privacy_policy/ role=menuitem aria-label="Navigate to Privacy policy">Privacy policy</a></li><li class=nav-item role=none><button id=darkModeToggle class="nav-link btn btn-link border-0" type=button role=menuitem aria-label="Toggle dark mode" title="Switch between light and dark themes">
<i class="fas fa-moon" id=darkModeIcon aria-hidden=true></i>
<span class="d-lg-none ms-2">ダークモード</span></button></li></ul></div></div></nav><script data-ad-client=ca-pub-9558545098866170 async crossorigin=anonymous src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></header><main id=main-content role=main class=site-main aria-label="Main content"><div class="container mt-4"><div class="row justify-content-center"><div class=col-lg-8><article itemscope itemtype=https://schema.org/Article><header class=article-header><h1 itemprop=headline>Particle Filter Python Implementation: Comparing Resampling Methods</h1><p class="lead article-description" itemprop=description>A Python implementation of the particle filter with systematic, residual, and stratified resampling, demonstrated on a nonlinear state estimation problem.</p><div class=article-meta><time datetime=2026-02-23T12:00:00+09:00 itemprop=datePublished><i class="far fa-calendar-alt me-1" aria-hidden=true></i>
February 23, 2026
</time><time datetime=2026-02-23T15:42:19+09:00 itemprop=dateModified class=ms-3><i class="far fa-edit me-1" aria-hidden=true></i>
Updated
February 23, 2026
</time><span aria-label="Reading time" class=ms-3><i class="far fa-clock me-1" aria-hidden=true></i>
7 min read</span></div><div class=article-tags role=group aria-label="Article tags"><a href=/en/tags/filtering/ class="badge badge-custom text-decoration-none me-1" rel=tag itemprop=keywords>Filtering
</a><a href=/en/tags/python/ class="badge badge-custom text-decoration-none me-1" rel=tag itemprop=keywords>Python
</a><a href=/en/tags/monte-carlo-method/ class="badge badge-custom text-decoration-none me-1" rel=tag itemprop=keywords>Monte Carlo Method</a></div></header><div class=article-content itemprop=articleBody><h2 id=what-is-a-particle-filter>What is a Particle Filter?</h2><p>The particle filter (also known as the Sequential Monte Carlo method, SMC) is a nonlinear filtering technique that represents the posterior distribution of the state using a set of weighted samples called particles. Unlike Gaussian-approximation filters, it requires no distributional assumptions and can handle arbitrary nonlinear and non-Gaussian systems.</p><p>Gaussian-approximation filters such as the <a href=https://yuhi-sa.github.io/en/posts/20260215_ckf/1/>Cubature Kalman Filter (CKF)</a> and the Unscented Kalman Filter (UKF) degrade in accuracy when the posterior distribution is multimodal or the system exhibits strong nonlinearities. The particle filter remains effective in these situations.</p><p>The particle filter shares its Monte Carlo sampling foundation with the <a href=https://yuhi-sa.github.io/en/posts/20210329_cem/1/>Cross-Entropy Method (CEM)</a>, but whereas CEM targets optimization problems, the particle filter targets sequential state estimation in time series.</p><h2 id=algorithm-overview>Algorithm Overview</h2><h3 id=state-space-model>State-Space Model</h3><p>Consider the following nonlinear state-space model:</p>\[
x_k = f(x_{k-1}) + w_{k-1}, \quad w_{k-1} \sim p_w
\]\[
y_k = h(x_k) + v_k, \quad v_k \sim p_v
\]<p>where \(f\) is the state transition function, \(h\) is the observation function, and \(w_{k-1}\), \(v_k\) are the process and observation noise respectively. The noise distributions \(p_w, p_v\) need not be Gaussian.</p><h3 id=sequential-monte-carlo-framework>Sequential Monte Carlo Framework</h3><p>The particle filter approximates the posterior distribution \(p(x_k | y_{1:k})\) using \(N\) weighted particles \(\{x_k^{(i)}, w_k^{(i)}\}_{i=1}^{N}\). Each step consists of three phases.</p><p><strong>1. Prediction:</strong> Propagate each particle through the state transition model:</p>\[
x_k^{(i)} \sim p(x_k | x_{k-1}^{(i)})
\]<p>In practice, this is implemented as \(x_k^{(i)} = f(x_{k-1}^{(i)}) + w_{k-1}^{(i)}\) by adding process noise.</p><p><strong>2. Weight Update:</strong> Compute the likelihood of the new observation \(y_k\) for each particle and update the weights:</p>\[
w_k^{(i)} \propto p(y_k | x_k^{(i)})
\]<p><strong>3. Normalization:</strong> Normalize the weights so they sum to one:</p>\[
\tilde{w}_k^{(i)} = \frac{w_k^{(i)}}{\sum_{j=1}^{N} w_k^{(j)}}
\]<p>The state estimate is then computed as a weighted average:</p>\[
\hat{x}_k = \sum_{i=1}^{N} \tilde{w}_k^{(i)} x_k^{(i)}
\]<h2 id=effective-sample-size-and-degeneracy>Effective Sample Size and Degeneracy</h2><p>A major challenge in particle filtering is <strong>weight degeneracy</strong>: over time, most particles acquire negligibly small weights while a few particles dominate. This degeneracy is quantified by the <strong>Effective Sample Size (ESS)</strong>:</p>\[
N_{\text{eff}} = \frac{1}{\sum_{i=1}^{N} (\tilde{w}_k^{(i)})^2}
\]<p>\(N_{\text{eff}}\) ranges from 1 to \(N\). When all weights are equal (no degeneracy), \(N_{\text{eff}} = N\). Resampling is triggered when \(N_{\text{eff}}\) drops below a threshold, typically \(N/2\).</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>def</span> <span class=nf>effective_sample_size</span><span class=p>(</span><span class=n>weights</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;Compute the effective sample size.&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=mf>1.0</span> <span class=o>/</span> <span class=n>np</span><span class=o>.</span><span class=n>sum</span><span class=p>(</span><span class=n>weights</span> <span class=o>**</span> <span class=mi>2</span><span class=p>)</span>
</span></span></code></pre></div><h2 id=resampling-methods>Resampling Methods</h2><p>Resampling reconstructs the particle set by duplicating high-weight particles and discarding low-weight ones. Below are three widely used methods.</p><h3 id=systematic-resampling>Systematic Resampling</h3><p>Systematic resampling generates a single random number \(u_0\) and places equally spaced points along the cumulative distribution function (CDF). It has \(O(N)\) complexity and low variance, making it the most commonly used method in practice.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>def</span> <span class=nf>systematic_resampling</span><span class=p>(</span><span class=n>weights</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;Systematic resampling.&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>N</span> <span class=o>=</span> <span class=nb>len</span><span class=p>(</span><span class=n>weights</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>positions</span> <span class=o>=</span> <span class=p>(</span><span class=n>np</span><span class=o>.</span><span class=n>random</span><span class=o>.</span><span class=n>random</span><span class=p>()</span> <span class=o>+</span> <span class=n>np</span><span class=o>.</span><span class=n>arange</span><span class=p>(</span><span class=n>N</span><span class=p>))</span> <span class=o>/</span> <span class=n>N</span>
</span></span><span class=line><span class=cl>    <span class=n>cumsum</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>cumsum</span><span class=p>(</span><span class=n>weights</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>indices</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>zeros</span><span class=p>(</span><span class=n>N</span><span class=p>,</span> <span class=n>dtype</span><span class=o>=</span><span class=nb>int</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>i</span><span class=p>,</span> <span class=n>j</span> <span class=o>=</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>    <span class=k>while</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=n>N</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>positions</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>&lt;</span> <span class=n>cumsum</span><span class=p>[</span><span class=n>j</span><span class=p>]:</span>
</span></span><span class=line><span class=cl>            <span class=n>indices</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>=</span> <span class=n>j</span>
</span></span><span class=line><span class=cl>            <span class=n>i</span> <span class=o>+=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>j</span> <span class=o>+=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>indices</span>
</span></span></code></pre></div><h3 id=residual-resampling>Residual Resampling</h3><p>Residual resampling first deterministically copies each particle \(\lfloor N \tilde{w}^{(i)} \rfloor\) times, then samples the remaining particles probabilistically from the residual weights. The deterministic component reduces variance compared to purely random methods.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>def</span> <span class=nf>residual_resampling</span><span class=p>(</span><span class=n>weights</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;Residual resampling.&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>N</span> <span class=o>=</span> <span class=nb>len</span><span class=p>(</span><span class=n>weights</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>indices</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># Deterministic copies</span>
</span></span><span class=line><span class=cl>    <span class=n>num_copies</span> <span class=o>=</span> <span class=p>(</span><span class=n>N</span> <span class=o>*</span> <span class=n>weights</span><span class=p>)</span><span class=o>.</span><span class=n>astype</span><span class=p>(</span><span class=nb>int</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>N</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>indices</span><span class=o>.</span><span class=n>extend</span><span class=p>([</span><span class=n>i</span><span class=p>]</span> <span class=o>*</span> <span class=n>num_copies</span><span class=p>[</span><span class=n>i</span><span class=p>])</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># Handle residuals</span>
</span></span><span class=line><span class=cl>    <span class=n>residual_weights</span> <span class=o>=</span> <span class=n>N</span> <span class=o>*</span> <span class=n>weights</span> <span class=o>-</span> <span class=n>num_copies</span>
</span></span><span class=line><span class=cl>    <span class=n>residual_weights</span> <span class=o>/=</span> <span class=n>residual_weights</span><span class=o>.</span><span class=n>sum</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>num_remaining</span> <span class=o>=</span> <span class=n>N</span> <span class=o>-</span> <span class=nb>len</span><span class=p>(</span><span class=n>indices</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>num_remaining</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>cumsum</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>cumsum</span><span class=p>(</span><span class=n>residual_weights</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=c1># Apply systematic resampling to the residual part</span>
</span></span><span class=line><span class=cl>        <span class=n>positions</span> <span class=o>=</span> <span class=p>(</span><span class=n>np</span><span class=o>.</span><span class=n>random</span><span class=o>.</span><span class=n>random</span><span class=p>()</span> <span class=o>+</span> <span class=n>np</span><span class=o>.</span><span class=n>arange</span><span class=p>(</span><span class=n>num_remaining</span><span class=p>))</span> <span class=o>/</span> <span class=n>num_remaining</span>
</span></span><span class=line><span class=cl>        <span class=n>i</span><span class=p>,</span> <span class=n>j</span> <span class=o>=</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>        <span class=k>while</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=n>num_remaining</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>positions</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>&lt;</span> <span class=n>cumsum</span><span class=p>[</span><span class=n>j</span><span class=p>]:</span>
</span></span><span class=line><span class=cl>                <span class=n>indices</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>j</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=n>i</span> <span class=o>+=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>            <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>j</span> <span class=o>+=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>np</span><span class=o>.</span><span class=n>array</span><span class=p>(</span><span class=n>indices</span><span class=p>)</span>
</span></span></code></pre></div><h3 id=stratified-resampling>Stratified Resampling</h3><p>Stratified resampling divides the \([0, 1)\) interval into \(N\) equal strata and draws an independent uniform random number within each stratum to sample from the CDF. It is similar to systematic resampling but uses independent random numbers per stratum.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>def</span> <span class=nf>stratified_resampling</span><span class=p>(</span><span class=n>weights</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;Stratified resampling.&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>N</span> <span class=o>=</span> <span class=nb>len</span><span class=p>(</span><span class=n>weights</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>positions</span> <span class=o>=</span> <span class=p>(</span><span class=n>np</span><span class=o>.</span><span class=n>random</span><span class=o>.</span><span class=n>random</span><span class=p>(</span><span class=n>N</span><span class=p>)</span> <span class=o>+</span> <span class=n>np</span><span class=o>.</span><span class=n>arange</span><span class=p>(</span><span class=n>N</span><span class=p>))</span> <span class=o>/</span> <span class=n>N</span>
</span></span><span class=line><span class=cl>    <span class=n>cumsum</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>cumsum</span><span class=p>(</span><span class=n>weights</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>indices</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>zeros</span><span class=p>(</span><span class=n>N</span><span class=p>,</span> <span class=n>dtype</span><span class=o>=</span><span class=nb>int</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>i</span><span class=p>,</span> <span class=n>j</span> <span class=o>=</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>    <span class=k>while</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=n>N</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>positions</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>&lt;</span> <span class=n>cumsum</span><span class=p>[</span><span class=n>j</span><span class=p>]:</span>
</span></span><span class=line><span class=cl>            <span class=n>indices</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>=</span> <span class=n>j</span>
</span></span><span class=line><span class=cl>            <span class=n>i</span> <span class=o>+=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>j</span> <span class=o>+=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>indices</span>
</span></span></code></pre></div><h2 id=nonlinear-system-demo>Nonlinear System Demo</h2><h3 id=benchmark-model>Benchmark Model</h3><p>To evaluate particle filter performance, we use the widely adopted <strong>Univariate Nonstationary Growth Model</strong>. This model exhibits strong nonlinearity that challenges Gaussian-approximation filters.</p><p>State transition model:</p>\[
x_k = \frac{x_{k-1}}{2} + \frac{25 x_{k-1}}{1 + x_{k-1}^2} + 8\cos(1.2k) + w_k, \quad w_k \sim \mathcal{N}(0, \sigma_w^2)
\]<p>Observation model:</p>\[
y_k = \frac{x_k^2}{20} + v_k, \quad v_k \sim \mathcal{N}(0, \sigma_v^2)
\]<p>A key feature of this model is that the observation function \(h(x) = x^2/20\) is an even function, so positive and negative state values are indistinguishable from observations alone. This can produce a bimodal posterior distribution.</p><h3 id=particle-filter-implementation>Particle Filter Implementation</h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>numpy</span> <span class=k>as</span> <span class=nn>np</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>matplotlib.pyplot</span> <span class=k>as</span> <span class=nn>plt</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># ---- Model definition ----</span>
</span></span><span class=line><span class=cl><span class=n>sigma_w</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>sqrt</span><span class=p>(</span><span class=mf>10.0</span><span class=p>)</span>  <span class=c1># process noise std</span>
</span></span><span class=line><span class=cl><span class=n>sigma_v</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>sqrt</span><span class=p>(</span><span class=mf>1.0</span><span class=p>)</span>   <span class=c1># observation noise std</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>state_transition</span><span class=p>(</span><span class=n>x</span><span class=p>,</span> <span class=n>k</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;State transition function.&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>x</span> <span class=o>/</span> <span class=mf>2.0</span> <span class=o>+</span> <span class=mf>25.0</span> <span class=o>*</span> <span class=n>x</span> <span class=o>/</span> <span class=p>(</span><span class=mf>1.0</span> <span class=o>+</span> <span class=n>x</span> <span class=o>**</span> <span class=mi>2</span><span class=p>)</span> <span class=o>+</span> <span class=mf>8.0</span> <span class=o>*</span> <span class=n>np</span><span class=o>.</span><span class=n>cos</span><span class=p>(</span><span class=mf>1.2</span> <span class=o>*</span> <span class=n>k</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>observation</span><span class=p>(</span><span class=n>x</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;Observation function.&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>x</span> <span class=o>**</span> <span class=mi>2</span> <span class=o>/</span> <span class=mf>20.0</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>log_likelihood</span><span class=p>(</span><span class=n>y</span><span class=p>,</span> <span class=n>x</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;Log-likelihood log p(y|x).&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>diff</span> <span class=o>=</span> <span class=n>y</span> <span class=o>-</span> <span class=n>observation</span><span class=p>(</span><span class=n>x</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=o>-</span><span class=mf>0.5</span> <span class=o>*</span> <span class=p>(</span><span class=n>diff</span> <span class=o>**</span> <span class=mi>2</span><span class=p>)</span> <span class=o>/</span> <span class=p>(</span><span class=n>sigma_v</span> <span class=o>**</span> <span class=mi>2</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># ---- Particle filter ----</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>particle_filter</span><span class=p>(</span><span class=n>y_obs</span><span class=p>,</span> <span class=n>N_particles</span><span class=p>,</span> <span class=n>resample_fn</span><span class=p>,</span> <span class=n>resample_threshold</span><span class=o>=</span><span class=mf>0.5</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>    Run the particle filter.
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>    Parameters
</span></span></span><span class=line><span class=cl><span class=s2>    ----------
</span></span></span><span class=line><span class=cl><span class=s2>    y_obs : array, observation sequence
</span></span></span><span class=line><span class=cl><span class=s2>    N_particles : int, number of particles
</span></span></span><span class=line><span class=cl><span class=s2>    resample_fn : callable, resampling function
</span></span></span><span class=line><span class=cl><span class=s2>    resample_threshold : float, ESS threshold (ratio of N_particles)
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>    Returns
</span></span></span><span class=line><span class=cl><span class=s2>    -------
</span></span></span><span class=line><span class=cl><span class=s2>    x_est : array, state estimate sequence
</span></span></span><span class=line><span class=cl><span class=s2>    ess_history : array, ESS history
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>T</span> <span class=o>=</span> <span class=nb>len</span><span class=p>(</span><span class=n>y_obs</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>threshold</span> <span class=o>=</span> <span class=n>resample_threshold</span> <span class=o>*</span> <span class=n>N_particles</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># Initialize: sample from prior</span>
</span></span><span class=line><span class=cl>    <span class=n>particles</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>random</span><span class=o>.</span><span class=n>normal</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=n>np</span><span class=o>.</span><span class=n>sqrt</span><span class=p>(</span><span class=mf>5.0</span><span class=p>),</span> <span class=n>N_particles</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>weights</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>ones</span><span class=p>(</span><span class=n>N_particles</span><span class=p>)</span> <span class=o>/</span> <span class=n>N_particles</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>x_est</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>zeros</span><span class=p>(</span><span class=n>T</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>ess_history</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>zeros</span><span class=p>(</span><span class=n>T</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>k</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>T</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=c1># Prediction: state transition + process noise</span>
</span></span><span class=line><span class=cl>        <span class=n>particles</span> <span class=o>=</span> <span class=n>state_transition</span><span class=p>(</span><span class=n>particles</span><span class=p>,</span> <span class=n>k</span> <span class=o>+</span> <span class=mi>1</span><span class=p>)</span> \
</span></span><span class=line><span class=cl>                    <span class=o>+</span> <span class=n>sigma_w</span> <span class=o>*</span> <span class=n>np</span><span class=o>.</span><span class=n>random</span><span class=o>.</span><span class=n>randn</span><span class=p>(</span><span class=n>N_particles</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1># Weight update: compute in log domain for numerical stability</span>
</span></span><span class=line><span class=cl>        <span class=n>log_w</span> <span class=o>=</span> <span class=n>log_likelihood</span><span class=p>(</span><span class=n>y_obs</span><span class=p>[</span><span class=n>k</span><span class=p>],</span> <span class=n>particles</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>log_w</span> <span class=o>-=</span> <span class=n>np</span><span class=o>.</span><span class=n>max</span><span class=p>(</span><span class=n>log_w</span><span class=p>)</span>  <span class=c1># numerical stabilization</span>
</span></span><span class=line><span class=cl>        <span class=n>weights</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>exp</span><span class=p>(</span><span class=n>log_w</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>weights</span> <span class=o>/=</span> <span class=n>np</span><span class=o>.</span><span class=n>sum</span><span class=p>(</span><span class=n>weights</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1># State estimate</span>
</span></span><span class=line><span class=cl>        <span class=n>x_est</span><span class=p>[</span><span class=n>k</span><span class=p>]</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>sum</span><span class=p>(</span><span class=n>weights</span> <span class=o>*</span> <span class=n>particles</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1># ESS computation</span>
</span></span><span class=line><span class=cl>        <span class=n>ess</span> <span class=o>=</span> <span class=n>effective_sample_size</span><span class=p>(</span><span class=n>weights</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>ess_history</span><span class=p>[</span><span class=n>k</span><span class=p>]</span> <span class=o>=</span> <span class=n>ess</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1># Resampling (ESS threshold-based)</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>ess</span> <span class=o>&lt;</span> <span class=n>threshold</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>indices</span> <span class=o>=</span> <span class=n>resample_fn</span><span class=p>(</span><span class=n>weights</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>particles</span> <span class=o>=</span> <span class=n>particles</span><span class=p>[</span><span class=n>indices</span><span class=p>]</span>
</span></span><span class=line><span class=cl>            <span class=n>weights</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>ones</span><span class=p>(</span><span class=n>N_particles</span><span class=p>)</span> <span class=o>/</span> <span class=n>N_particles</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>x_est</span><span class=p>,</span> <span class=n>ess_history</span>
</span></span></code></pre></div><h3 id=running-the-simulation>Running the Simulation</h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>np</span><span class=o>.</span><span class=n>random</span><span class=o>.</span><span class=n>seed</span><span class=p>(</span><span class=mi>42</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>T</span> <span class=o>=</span> <span class=mi>100</span>            <span class=c1># number of time steps</span>
</span></span><span class=line><span class=cl><span class=n>N_particles</span> <span class=o>=</span> <span class=mi>500</span>  <span class=c1># number of particles</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Generate true state and observations</span>
</span></span><span class=line><span class=cl><span class=n>x_true</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>zeros</span><span class=p>(</span><span class=n>T</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>y_obs</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>zeros</span><span class=p>(</span><span class=n>T</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>x_true</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span> <span class=o>=</span> <span class=mf>0.1</span>  <span class=c1># initial state</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>k</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=n>T</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>x_true</span><span class=p>[</span><span class=n>k</span><span class=p>]</span> <span class=o>=</span> <span class=n>state_transition</span><span class=p>(</span><span class=n>x_true</span><span class=p>[</span><span class=n>k</span> <span class=o>-</span> <span class=mi>1</span><span class=p>],</span> <span class=n>k</span><span class=p>)</span> \
</span></span><span class=line><span class=cl>                <span class=o>+</span> <span class=n>sigma_w</span> <span class=o>*</span> <span class=n>np</span><span class=o>.</span><span class=n>random</span><span class=o>.</span><span class=n>randn</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>k</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>T</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>y_obs</span><span class=p>[</span><span class=n>k</span><span class=p>]</span> <span class=o>=</span> <span class=n>observation</span><span class=p>(</span><span class=n>x_true</span><span class=p>[</span><span class=n>k</span><span class=p>])</span> <span class=o>+</span> <span class=n>sigma_v</span> <span class=o>*</span> <span class=n>np</span><span class=o>.</span><span class=n>random</span><span class=o>.</span><span class=n>randn</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Run particle filter with three resampling methods</span>
</span></span><span class=line><span class=cl><span class=n>resamplers</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;Systematic&#34;</span><span class=p>:</span> <span class=n>systematic_resampling</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;Residual&#34;</span><span class=p>:</span> <span class=n>residual_resampling</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;Stratified&#34;</span><span class=p>:</span> <span class=n>stratified_resampling</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>results</span> <span class=o>=</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>name</span><span class=p>,</span> <span class=n>fn</span> <span class=ow>in</span> <span class=n>resamplers</span><span class=o>.</span><span class=n>items</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=n>np</span><span class=o>.</span><span class=n>random</span><span class=o>.</span><span class=n>seed</span><span class=p>(</span><span class=mi>42</span><span class=p>)</span>  <span class=c1># same seed for fair comparison</span>
</span></span><span class=line><span class=cl>    <span class=n>x_est</span><span class=p>,</span> <span class=n>ess_hist</span> <span class=o>=</span> <span class=n>particle_filter</span><span class=p>(</span><span class=n>y_obs</span><span class=p>,</span> <span class=n>N_particles</span><span class=p>,</span> <span class=n>fn</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>rmse</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>sqrt</span><span class=p>(</span><span class=n>np</span><span class=o>.</span><span class=n>mean</span><span class=p>((</span><span class=n>x_true</span> <span class=o>-</span> <span class=n>x_est</span><span class=p>)</span> <span class=o>**</span> <span class=mi>2</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=n>results</span><span class=p>[</span><span class=n>name</span><span class=p>]</span> <span class=o>=</span> <span class=p>{</span><span class=s2>&#34;estimate&#34;</span><span class=p>:</span> <span class=n>x_est</span><span class=p>,</span> <span class=s2>&#34;ess&#34;</span><span class=p>:</span> <span class=n>ess_hist</span><span class=p>,</span> <span class=s2>&#34;rmse&#34;</span><span class=p>:</span> <span class=n>rmse</span><span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>name</span><span class=si>}</span><span class=s2>: RMSE = </span><span class=si>{</span><span class=n>rmse</span><span class=si>:</span><span class=s2>.4f</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span></code></pre></div><h3 id=visualization>Visualization</h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>fig</span><span class=p>,</span> <span class=n>axes</span> <span class=o>=</span> <span class=n>plt</span><span class=o>.</span><span class=n>subplots</span><span class=p>(</span><span class=mi>2</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=n>figsize</span><span class=o>=</span><span class=p>(</span><span class=mi>12</span><span class=p>,</span> <span class=mi>8</span><span class=p>),</span> <span class=n>sharex</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># State estimation comparison</span>
</span></span><span class=line><span class=cl><span class=n>axes</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span><span class=o>.</span><span class=n>plot</span><span class=p>(</span><span class=n>x_true</span><span class=p>,</span> <span class=s2>&#34;k-&#34;</span><span class=p>,</span> <span class=n>linewidth</span><span class=o>=</span><span class=mf>1.5</span><span class=p>,</span> <span class=n>label</span><span class=o>=</span><span class=s2>&#34;True state&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>colors</span> <span class=o>=</span> <span class=p>{</span><span class=s2>&#34;Systematic&#34;</span><span class=p>:</span> <span class=s2>&#34;tab:blue&#34;</span><span class=p>,</span> <span class=s2>&#34;Residual&#34;</span><span class=p>:</span> <span class=s2>&#34;tab:orange&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=s2>&#34;Stratified&#34;</span><span class=p>:</span> <span class=s2>&#34;tab:green&#34;</span><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>name</span><span class=p>,</span> <span class=n>res</span> <span class=ow>in</span> <span class=n>results</span><span class=o>.</span><span class=n>items</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=n>axes</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span><span class=o>.</span><span class=n>plot</span><span class=p>(</span><span class=n>res</span><span class=p>[</span><span class=s2>&#34;estimate&#34;</span><span class=p>],</span> <span class=s2>&#34;--&#34;</span><span class=p>,</span> <span class=n>color</span><span class=o>=</span><span class=n>colors</span><span class=p>[</span><span class=n>name</span><span class=p>],</span>
</span></span><span class=line><span class=cl>                 <span class=n>linewidth</span><span class=o>=</span><span class=mi>1</span><span class=p>,</span> <span class=n>label</span><span class=o>=</span><span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>name</span><span class=si>}</span><span class=s2> (RMSE=</span><span class=si>{</span><span class=n>res</span><span class=p>[</span><span class=s1>&#39;rmse&#39;</span><span class=p>]</span><span class=si>:</span><span class=s2>.2f</span><span class=si>}</span><span class=s2>)&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>axes</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span><span class=o>.</span><span class=n>set_ylabel</span><span class=p>(</span><span class=s2>&#34;State $x_k$&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>axes</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span><span class=o>.</span><span class=n>set_title</span><span class=p>(</span><span class=s2>&#34;Particle Filter: Resampling Method Comparison&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>axes</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span><span class=o>.</span><span class=n>legend</span><span class=p>(</span><span class=n>loc</span><span class=o>=</span><span class=s2>&#34;upper right&#34;</span><span class=p>,</span> <span class=n>fontsize</span><span class=o>=</span><span class=mi>9</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>axes</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span><span class=o>.</span><span class=n>grid</span><span class=p>(</span><span class=kc>True</span><span class=p>,</span> <span class=n>alpha</span><span class=o>=</span><span class=mf>0.3</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># ESS over time</span>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>name</span><span class=p>,</span> <span class=n>res</span> <span class=ow>in</span> <span class=n>results</span><span class=o>.</span><span class=n>items</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=n>axes</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span><span class=o>.</span><span class=n>plot</span><span class=p>(</span><span class=n>res</span><span class=p>[</span><span class=s2>&#34;ess&#34;</span><span class=p>],</span> <span class=n>color</span><span class=o>=</span><span class=n>colors</span><span class=p>[</span><span class=n>name</span><span class=p>],</span> <span class=n>linewidth</span><span class=o>=</span><span class=mf>0.8</span><span class=p>,</span> <span class=n>label</span><span class=o>=</span><span class=n>name</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>axes</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span><span class=o>.</span><span class=n>axhline</span><span class=p>(</span><span class=n>y</span><span class=o>=</span><span class=n>N_particles</span> <span class=o>/</span> <span class=mi>2</span><span class=p>,</span> <span class=n>color</span><span class=o>=</span><span class=s2>&#34;red&#34;</span><span class=p>,</span> <span class=n>linestyle</span><span class=o>=</span><span class=s2>&#34;:&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=n>label</span><span class=o>=</span><span class=sa>f</span><span class=s2>&#34;Threshold (N/2=</span><span class=si>{</span><span class=n>N_particles</span> <span class=o>//</span> <span class=mi>2</span><span class=si>}</span><span class=s2>)&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>axes</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span><span class=o>.</span><span class=n>set_xlabel</span><span class=p>(</span><span class=s2>&#34;Time step $k$&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>axes</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span><span class=o>.</span><span class=n>set_ylabel</span><span class=p>(</span><span class=s2>&#34;Effective Sample Size&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>axes</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span><span class=o>.</span><span class=n>legend</span><span class=p>(</span><span class=n>loc</span><span class=o>=</span><span class=s2>&#34;upper right&#34;</span><span class=p>,</span> <span class=n>fontsize</span><span class=o>=</span><span class=mi>9</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>axes</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span><span class=o>.</span><span class=n>grid</span><span class=p>(</span><span class=kc>True</span><span class=p>,</span> <span class=n>alpha</span><span class=o>=</span><span class=mf>0.3</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>plt</span><span class=o>.</span><span class=n>tight_layout</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>plt</span><span class=o>.</span><span class=n>savefig</span><span class=p>(</span><span class=s2>&#34;particle_filter_comparison.png&#34;</span><span class=p>,</span> <span class=n>dpi</span><span class=o>=</span><span class=mi>150</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>plt</span><span class=o>.</span><span class=n>show</span><span class=p>()</span>
</span></span></code></pre></div><h2 id=comparison-of-filtering-methods>Comparison of Filtering Methods</h2><p>The following table compares the particle filter with Gaussian-approximation filters.</p><table><thead><tr><th>Property</th><th>Particle Filter</th><th>UKF</th><th><a href=https://yuhi-sa.github.io/en/posts/20260215_ckf/1/>CKF</a></th></tr></thead><tbody><tr><td>Distribution assumption</td><td>None (arbitrary)</td><td>Gaussian</td><td>Gaussian</td></tr><tr><td>Computational cost</td><td>\(O(N)\) (depends on particle count)</td><td>\(O(n^3)\)</td><td>\(O(n^3)\)</td></tr><tr><td>Parameters</td><td>Particle count \(N\), ESS threshold</td><td>\(\alpha, \beta, \kappa\)</td><td>None</td></tr><tr><td>Multimodality</td><td>Supported</td><td>Not supported</td><td>Not supported</td></tr><tr><td>High dimensions</td><td>Difficult (curse of dimensionality)</td><td>Good</td><td>Good</td></tr><tr><td>Implementation complexity</td><td>Moderate</td><td>Moderate</td><td>Low</td></tr></tbody></table><p>The particle filter&rsquo;s key advantage is its freedom from distributional assumptions, but it faces the &ldquo;curse of dimensionality&rdquo; in high-dimensional problems where the required number of particles grows exponentially. For low-dimensional problems with strong nonlinearity or non-Gaussianity, the particle filter is the method of choice. For high-dimensional problems with moderate nonlinearity, CKF or UKF are more practical.</p><h2 id=references>References</h2><ul><li>Arulampalam, M. S., Maskell, S., Gordon, N., & Clapp, T. (2002). &ldquo;A Tutorial on Particle Filters for Online Nonlinear/Non-Gaussian Bayesian Tracking.&rdquo; <em>IEEE Transactions on Signal Processing</em>, 50(2), 174-188.</li><li>Doucet, A., & Johansen, A. M. (2009). &ldquo;A Tutorial on Particle Filtering and Smoothing: Fifteen Years Later.&rdquo; <em>Handbook of Nonlinear Filtering</em>, 12(656-704), 3.</li><li>Douc, R., & Cappe, O. (2005). &ldquo;Comparison of Resampling Schemes for Particle Filtering.&rdquo; <em>Proceedings of the 4th International Symposium on Image and Signal Processing and Analysis</em>, 64-69.</li></ul></div><div class="ad-slot in-content my-3"><ins class=adsbygoogle style=display:block;text-align:center data-ad-layout=in-article data-ad-format=fluid data-ad-client=ca-pub-9558545098866170></ins><script>(adsbygoogle=window.adsbygoogle||[]).push({})</script></div><footer class=article-footer></footer><meta itemprop=wordCount content="1453"><meta itemprop=url content="https://yuhi-sa.github.io/en/posts/20260223_particle_filter/1/"></article><nav class="post-nav mt-5" aria-label="Post navigation"><a href=/en/posts/20260223_lowpass_filter/1/ class="post-nav__item post-nav__item--prev"><span class="post-nav__label text-muted"><i class="fas fa-arrow-left me-1" aria-hidden=true></i>前の記事
</span><span class=post-nav__title>Low-Pass Filter Design and Comparison: Moving Average, Butterworth, and Chebyshev</span>
</a><a href=/en/posts/20260223_matplotlib_tips/1/ class="post-nav__item post-nav__item--next"><span class="post-nav__label text-muted">次の記事<i class="fas fa-arrow-right ms-1" aria-hidden=true></i>
</span><span class=post-nav__title>Matplotlib Practical Tips: Creating Publication-Quality Figures</span></a></nav><section class="related-posts mt-5" aria-label="Related posts"><h2 class=related-posts__title>関連記事</h2><div class=related-posts__grid><article class=related-posts__item><h3 class=related-posts__item-title><a href=/en/posts/20260223_rts_smoother/1/>Kalman Smoother (RTS Smoother): Theory and Python Implementation</a></h3><div class=card-meta><time datetime=2026-02-23>February 23, 2026</time></div></article><article class=related-posts__item><h3 class=related-posts__item-title><a href=/en/posts/20260223_lowpass_filter/1/>Low-Pass Filter Design and Comparison: Moving Average, Butterworth, and Chebyshev</a></h3><div class=card-meta><time datetime=2026-02-23>February 23, 2026</time></div></article><article class=related-posts__item><h3 class=related-posts__item-title><a href=/en/posts/20260215_mppi/1/>MPPI (Model Predictive Path Integral): A Unified View with the Cross-Entropy Method</a></h3><div class=card-meta><time datetime=2026-02-15>February 15, 2026</time></div></article></div></section><nav class="article-navigation mt-4" aria-label="Article navigation"><a href=/en/posts/ class="btn btn-outline-secondary btn-sm mb-3"><i class="fas fa-arrow-left me-1" aria-hidden=true></i>
Back to posts</a><nav aria-label="Breadcrumb navigation" class=breadcrumb-nav role=navigation><ol class=breadcrumb itemscope itemtype=https://schema.org/BreadcrumbList><li class=breadcrumb-item itemprop=itemListElement itemscope itemtype=https://schema.org/ListItem><a href=/en/ itemprop=item aria-label="Navigate to homepage"><i class="fas fa-home" aria-hidden=true></i>
<span itemprop=name>tomato blog</span>
</a><meta itemprop=position content="1"></li><li class=breadcrumb-item itemprop=itemListElement itemscope itemtype=https://schema.org/ListItem><a href=https://yuhi-sa.github.io/en/ itemprop=item aria-label="Navigate to tomato blog"><span itemprop=name>tomato blog</span>
</a><meta itemprop=position content="2"></li><li class=breadcrumb-item itemprop=itemListElement itemscope itemtype=https://schema.org/ListItem><a href=https://yuhi-sa.github.io/en/posts/ itemprop=item aria-label="Navigate to Posts"><span itemprop=name>Posts</span>
</a><meta itemprop=position content="3"></li><li class="breadcrumb-item active" aria-current=page itemprop=itemListElement itemscope itemtype=https://schema.org/ListItem><span itemprop=name>Particle Filter Python Implementation: Comparing Resampling Methods</span>
<meta itemprop=position content="4"></li></ol></nav></nav></div></div></div></main><footer role=contentinfo class=site-footer><div class="container pt-4 pb-3" style="border-top:2px solid var(--accent,#e54d2e)"><div class="row justify-content-center"><div class="col-md-8 text-center"><p class="copyright-text text-muted mb-2">&copy; 2026 yuhi-sa. All rights reserved.</p><p class="theme-attribution text-muted small mt-2 mb-0">Powered by
<a href=https://gohugo.io/ target=_blank rel=noopener class=text-decoration-none>Hugo</a>
with
<a href=https://github.com/yuhi-sa/tomatohugo target=_blank rel=noopener class=text-decoration-none>TomatoHugo</a></p></div></div></div></footer><script src=https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js integrity=sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz crossorigin=anonymous defer></script><script src=/js/dark-mode.min.3e457dc8346f064bee795e6f9b73e1516dcd059e750c521fe4b445f9ea9a7821.js integrity="sha256-PkV9yDRvBkvueV5vm3PhUW3NBZ51DFIf5LRF+eqaeCE=" defer></script><script>window.addEventListener("load",function(){const e=document.createElement("script");e.async=!0,e.src="https://www.googletagmanager.com/gtag/js?id=G-LN6QP6VVM3",document.head.appendChild(e),e.onload=function(){window.dataLayer=window.dataLayer||[];function e(){dataLayer.push(arguments)}e("js",new Date),e("config","G-LN6QP6VVM3")}})</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"WebPage","name":"Particle Filter Python Implementation: Comparing Resampling Methods","url":"https:\/\/yuhi-sa.github.io\/en\/posts\/20260223_particle_filter\/1\/","description":"A Python implementation of the particle filter with systematic, residual, and stratified resampling, demonstrated on a nonlinear state estimation problem.","inLanguage":"en","isPartOf":{"@type":"WebSite","name":"tomato blog","url":"https:\/\/yuhi-sa.github.io\/"}}</script></body></html>