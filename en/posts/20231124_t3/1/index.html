<!doctype html><html lang=en dir=ltr data-theme=light><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=format-detection content="telephone=no"><meta name=robots content="
    index
  
  ,follow"><meta name=description content="Exploring the technical challenges of sharing prom-client metrics between Next.js App Router and Pages Router, caused by separate JavaScript contexts."><meta name=author content="yuhi-sa"><link rel=canonical href=https://yuhi-sa.github.io/en/posts/20231124_t3/1/><meta property="og:type" content="
    article
  "><meta property="og:title" content="
    Technical Challenges of Sharing prom-client Metrics Between Next.js App Router and Pages Router
  "><meta property="og:description" content="Exploring the technical challenges of sharing prom-client metrics between Next.js App Router and Pages Router, caused by separate JavaScript contexts."><meta property="og:url" content="https://yuhi-sa.github.io/en/posts/20231124_t3/1/"><meta property="og:site_name" content="tomato blog"><meta property="og:locale" content="en"><meta property="og:image" content="https://yuhi-sa.github.io/ogp.jpeg"><meta property="og:image:width" content="1200"><meta property="og:image:height" content="630"><meta property="article:published_time" content="2023-11-24T09:00:23+09:00"><meta property="article:modified_time" content="2026-02-14T00:31:41+09:00"><meta property="article:tag" content="JavaScript"><meta property="article:tag" content="Next.js"><meta property="article:tag" content="Prometheus"><meta property="article:section" content="posts"><meta name=twitter:card content="summary_large_image"><meta name=twitter:title content="
    Technical Challenges of Sharing prom-client Metrics Between Next.js App Router and Pages Router
  "><meta name=twitter:description content="Exploring the technical challenges of sharing prom-client metrics between Next.js App Router and Pages Router, caused by separate JavaScript contexts."><meta name=twitter:image content="https://yuhi-sa.github.io/ogp.jpeg"><title>Technical Challenges of Sharing prom-client Metrics Between Next.js App Router and Pages Router |
tomato blog</title><link rel=preconnect href=https://fonts.googleapis.com><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=preconnect href=https://cdn.jsdelivr.net crossorigin><link rel=preconnect href=https://pagead2.googlesyndication.com crossorigin><link rel=dns-prefetch href=https://pagead2.googlesyndication.com><link rel=alternate hreflang=ja href=https://yuhi-sa.github.io/posts/20231124_t3/1/><link rel=alternate hreflang=en href=https://yuhi-sa.github.io/en/posts/20231124_t3/1/><link rel=alternate hreflang=x-default href=https://yuhi-sa.github.io/en/posts/20231124_t3/1/><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Technical Challenges of Sharing prom-client Metrics Between Next.js App Router and Pages Router","description":"Exploring the technical challenges of sharing prom-client metrics between Next.js App Router and Pages Router, caused by separate JavaScript contexts.","author":{"@type":"Person","name":"yuhi-sa"},"publisher":{"@type":"Organization","name":"tomato blog","url":"https:\/\/yuhi-sa.github.io\/"},"datePublished":"2023-11-24T09:00:23\u002b09:00","dateModified":"2026-02-14T00:31:41\u002b09:00","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/yuhi-sa.github.io\/en\/posts\/20231124_t3\/1\/"},"url":"https:\/\/yuhi-sa.github.io\/en\/posts\/20231124_t3\/1\/","wordCount":535,"keywords":["JavaScript","Next.js","Prometheus"],"articleSection":"Posts","inLanguage":"en","timeRequired":"PT3M"}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"tomato blog","item":"https:\/\/yuhi-sa.github.io\/en\/"},{"@type":"ListItem","position":2,"name":"Posts","item":"https:\/\/yuhi-sa.github.io\/en\/posts\/"},{"@type":"ListItem","position":3,"name":"Technical Challenges of Sharing prom-client Metrics Between Next.js App Router and Pages Router"}]}</script><link rel=preconnect href=https://fonts.googleapis.com><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel=stylesheet><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css integrity="sha512-iecdLmaskl7CVkqkXNQ/ZH/XLlvWZOJyj7Yy7tcenmpD1ypASozpmT/E0iPtmFIB46ZmdtAc9eNBvH0H/ZpiBw==" crossorigin=anonymous referrerpolicy=no-referrer><link href=https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css rel=stylesheet integrity=sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH crossorigin=anonymous><link rel=stylesheet href=/css/variables.min.de039aff98fb649abaf5fe23d3d4981f460573d7728709826e219c496c8e5be2.css integrity="sha256-3gOa/5j7ZJq69f4j09SYH0YFc9dyhwmCbiGcSWyOW+I=" crossorigin=anonymous><link rel=stylesheet href=/css/main.min.c50b1500452fdb66f687cdcbf45a7774123c0111e1054e26db51fee604557b28.css integrity="sha256-xQsVAEUv22b2h83L9Fp3dBI8ARHhBU4m21H+5gRVeyg=" crossorigin=anonymous><link rel=stylesheet href=/css/syntax.min.e379066489e20d5433ca35ac1f468fd9e8859705a62d77a79bb7379ac3613848.css integrity="sha256-43kGZIniDVQzyjWsH0aP2eiFlwWmLXenm7c3msNhOEg=" crossorigin=anonymous><style>body{font-family:-apple-system,BlinkMacSystemFont,inter,segoe ui,Roboto,sans-serif;line-height:1.5;color:#000;background:#fff}[data-theme=dark] body{color:#fff;background:#000}.container{max-width:768px;margin:0 auto;padding:0 1rem}</style><script src=https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js integrity=sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz crossorigin=anonymous defer></script><script src=/js/dark-mode.min.3e457dc8346f064bee795e6f9b73e1516dcd059e750c521fe4b445f9ea9a7821.js integrity="sha256-PkV9yDRvBkvueV5vm3PhUW3NBZ51DFIf5LRF+eqaeCE=" defer></script><script>window.addEventListener("load",function(){const e=document.createElement("script");e.async=!0,e.src="https://www.googletagmanager.com/gtag/js?id=G-LN6QP6VVM3",document.head.appendChild(e),e.onload=function(){window.dataLayer=window.dataLayer||[];function e(){dataLayer.push(arguments)}e("js",new Date),e("config","G-LN6QP6VVM3")}})</script></head><body itemscope itemtype=https://schema.org/WebPage class=theme-tomatohugo><a href=#main-content class="skip-link sr-only sr-only-focusable" aria-label="Skip to main content">Skip to main content</a><header role=banner class=site-header><nav class="navbar navbar-expand-lg navbar-light bg-light" role=navigation aria-label="Main navigation"><div class=container><a class=navbar-brand href=https://yuhi-sa.github.io/ aria-label="Return to tomato blog homepage">tomato blog
</a><button class="navbar-toggler d-lg-none" type=button data-bs-toggle=collapse data-bs-target=#navbarNav aria-controls=navbarNav aria-expanded=false aria-label="Toggle navigation menu">
<span class=navbar-toggler-icon></span></button><div class="collapse navbar-collapse" id=navbarNav><ul class="navbar-nav ms-auto" role=menubar><li class=nav-item role=none><a class=nav-link href=https://yuhi-sa.github.io/en/ role=menuitem aria-label="Navigate to Blog">Blog</a></li><li class=nav-item role=none><a class=nav-link href=https://yuhi-sa.github.io/en/tags/ role=menuitem aria-label="Navigate to Tags">Tags</a></li><li class=nav-item role=none><a class=nav-link href=https://yuhi-sa.github.io/en/posts/about/ role=menuitem aria-label="Navigate to About">About</a></li><li class=nav-item role=none><a class=nav-link href=https://yuhi-sa.github.io/en/posts/privacy_policy/ role=menuitem aria-label="Navigate to Privacy policy">Privacy policy</a></li><li class=nav-item role=none><button id=darkModeToggle class="nav-link btn btn-link border-0" type=button role=menuitem aria-label="Toggle dark mode" title="Switch between light and dark themes">
<i class="fas fa-moon" id=darkModeIcon aria-hidden=true></i>
<span class="d-lg-none ms-2">ダークモード</span></button></li></ul></div></div></nav><script data-ad-client=ca-pub-9558545098866170 async crossorigin=anonymous src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></header><main id=main-content role=main class=site-main aria-label="Main content"><div class="container mt-4"><div class="row justify-content-center"><div class=col-lg-8><article itemscope itemtype=https://schema.org/Article><header class=article-header><h1 itemprop=headline>Technical Challenges of Sharing prom-client Metrics Between Next.js App Router and Pages Router</h1><p class="lead article-description" itemprop=description>Exploring the technical challenges of sharing prom-client metrics between Next.js App Router and Pages Router, caused by separate JavaScript contexts.</p><div class=article-meta><time datetime=2023-11-24T09:00:23+09:00 itemprop=datePublished><i class="far fa-calendar-alt me-1" aria-hidden=true></i>
November 24, 2023
</time><time datetime=2026-02-14T00:31:41+09:00 itemprop=dateModified class=ms-3><i class="far fa-edit me-1" aria-hidden=true></i>
Updated
February 14, 2026
</time><span aria-label="Reading time" class=ms-3><i class="far fa-clock me-1" aria-hidden=true></i>
3 min read</span></div><div class=article-tags role=group aria-label="Article tags"><a href=/en/tags/javascript/ class="badge badge-custom text-decoration-none me-1" rel=tag itemprop=keywords>JavaScript
</a><a href=/en/tags/next.js/ class="badge badge-custom text-decoration-none me-1" rel=tag itemprop=keywords>Next.js
</a><a href=/en/tags/prometheus/ class="badge badge-custom text-decoration-none me-1" rel=tag itemprop=keywords>Prometheus</a></div></header><div class=article-content itemprop=articleBody><p>When trying to share common <code>prom-client</code> metrics (e.g., <code>Counter</code>) across both the <code>App Router</code> and <code>Pages Router</code> in a Next.js application, several challenges arise. Problems particularly occur when attempting to register a metrics registry on the <code>global</code> object.</p><h2 id=the-problem>The Problem</h2><p>In a Next.js project like a T3 Stack, I considered sharing a <code>prom-client</code> <code>Counter</code> through a <code>Logger</code> class for log metrics. Specifically, I tried registering <code>prom-client</code>&rsquo;s default registry on the <code>global</code> object to use a single metrics instance across the entire application.</p><p>However, with this approach, a build error occurred when trying to register a <code>Counter</code> to the <code>global</code> registry from a <code>Pages Router</code> API route.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-typescript:Logger.ts data-lang=typescript:Logger.ts><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>Counter</span> <span class=p>}</span> <span class=kr>from</span> <span class=s1>&#39;prom-client&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>class</span> <span class=nx>Logger</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kr>private</span> <span class=kr>static</span> <span class=nx>instance</span>: <span class=kt>Logger</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=kr>private</span> <span class=nx>errorCounter</span>: <span class=kt>Counter</span><span class=p>&lt;</span><span class=nt>string</span><span class=p>&gt;;</span>
</span></span><span class=line><span class=cl>  <span class=kr>private</span> <span class=nx>warnCounter</span>: <span class=kt>Counter</span><span class=p>&lt;</span><span class=nt>string</span><span class=p>&gt;;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=kr>private</span> <span class=kr>constructor</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// Problems occur when trying to initialize Counters and register them with the default registry here
</span></span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>errorCounter</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>Counter</span><span class=p>({</span>
</span></span><span class=line><span class=cl>      <span class=nx>name</span><span class=o>:</span> <span class=s1>&#39;errors_total&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>help</span><span class=o>:</span> <span class=s1>&#39;Total number of errors&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>warnCounter</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>Counter</span><span class=p>({</span>
</span></span><span class=line><span class=cl>      <span class=nx>name</span><span class=o>:</span> <span class=s1>&#39;warnings_total&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>help</span><span class=o>:</span> <span class=s1>&#39;Total number of warnings&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=p>});</span>
</span></span><span class=line><span class=cl>    <span class=c1>// prom-client&#39;s default registry is managed globally, but
</span></span></span><span class=line><span class=cl>    <span class=c1>// in the Next.js environment, App Router and Pages Router have different contexts,
</span></span></span><span class=line><span class=cl>    <span class=c1>// so sharing the global object may not work as expected.
</span></span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=kr>public</span> <span class=kr>static</span> <span class=nx>getInstance</span><span class=p>()</span><span class=o>:</span> <span class=nx>Logger</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=nx>Logger</span><span class=p>.</span><span class=nx>instance</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>Logger</span><span class=p>.</span><span class=nx>instance</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>Logger</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>Logger</span><span class=p>.</span><span class=nx>instance</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=c1>// ... logging methods ...
</span></span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><h2 id=workaround-and-remaining-issues>Workaround and Remaining Issues</h2><p>To work around this problem, I tried having the <code>Logger</code> class hold its own <code>prom-client</code> <code>register</code> instance.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-typescript:Logger.ts data-lang=typescript:Logger.ts><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>Counter</span><span class=p>,</span> <span class=nx>register</span> <span class=p>}</span> <span class=kr>from</span> <span class=s1>&#39;prom-client&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>class</span> <span class=nx>Logger</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kr>private</span> <span class=kr>static</span> <span class=nx>instance</span>: <span class=kt>Logger</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=kr>private</span> <span class=nx>errorCounter</span>: <span class=kt>Counter</span><span class=p>&lt;</span><span class=nt>string</span><span class=p>&gt;;</span>
</span></span><span class=line><span class=cl>  <span class=kr>private</span> <span class=nx>warnCounter</span>: <span class=kt>Counter</span><span class=p>&lt;</span><span class=nt>string</span><span class=p>&gt;;</span>
</span></span><span class=line><span class=cl>  <span class=kr>private</span> <span class=nx>registerInstance</span>: <span class=kt>typeof</span> <span class=nx>register</span><span class=p>;</span> <span class=c1>// Hold the register instance
</span></span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=kr>private</span> <span class=kr>constructor</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>registerInstance</span> <span class=o>=</span> <span class=nx>register</span><span class=p>;</span> <span class=c1>// Get the default registry instance
</span></span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>errorCounter</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>Counter</span><span class=p>({</span>
</span></span><span class=line><span class=cl>      <span class=nx>name</span><span class=o>:</span> <span class=s1>&#39;errors_total&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>help</span><span class=o>:</span> <span class=s1>&#39;Total number of errors&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>registers</span><span class=o>:</span> <span class=p>[</span><span class=k>this</span><span class=p>.</span><span class=nx>registerInstance</span><span class=p>],</span> <span class=c1>// Register with this registry
</span></span></span><span class=line><span class=cl>    <span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>warnCounter</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>Counter</span><span class=p>({</span>
</span></span><span class=line><span class=cl>      <span class=nx>name</span><span class=o>:</span> <span class=s1>&#39;warnings_total&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>help</span><span class=o>:</span> <span class=s1>&#39;Total number of warnings&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>registers</span><span class=o>:</span> <span class=p>[</span><span class=k>this</span><span class=p>.</span><span class=nx>registerInstance</span><span class=p>],</span> <span class=c1>// Register with this registry
</span></span></span><span class=line><span class=cl>    <span class=p>});</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=kr>public</span> <span class=kr>static</span> <span class=nx>getInstance</span><span class=p>()</span><span class=o>:</span> <span class=nx>Logger</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=nx>Logger</span><span class=p>.</span><span class=nx>instance</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>Logger</span><span class=p>.</span><span class=nx>instance</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>Logger</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>Logger</span><span class=p>.</span><span class=nx>instance</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c1>// Method to register metrics (if needed)
</span></span></span><span class=line><span class=cl>  <span class=kr>public</span> <span class=nx>registerMetric</span><span class=p>(</span><span class=nx>metric</span>: <span class=kt>Counter</span><span class=p>&lt;</span><span class=nt>string</span><span class=p>&gt;)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>this</span><span class=p>.</span><span class=nx>registerInstance</span><span class=p>.</span><span class=nx>registerMetric</span><span class=p>(</span><span class=nx>metric</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=c1>// ... logging methods ...
</span></span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>export</span> <span class=k>default</span> <span class=nx>Logger</span><span class=p>;</span>
</span></span></code></pre></div><p>This approach resolved the build error, but the fundamental problem was not solved. The <code>App Router</code> and <code>Pages Router</code> API routes appear to run in different JavaScript contexts within Next.js&rsquo;s build and runtime environment. Therefore, even when trying to share a <code>register</code> instance, <strong>separate <code>prom-client</code> registry instances</strong> are actually created, making it impossible to truly share metrics.</p><p>This is likely because Next.js&rsquo;s <code>App Router</code> and <code>Pages Router</code> API routes may execute in different Node.js processes or V8 contexts. The <code>global</code> object is only valid within its context and is not shared across different contexts.</p><p>This issue has also been mentioned in Next.js GitHub Discussions, and no clear solution has been provided as of November 2023.</p><ul><li><a href=https://github.com/vercel/next.js/discussions/49798>Next.js GitHub Discussions: <code>prom-client</code> metrics not shared between App Router and Pages Router API routes</a></li></ul><h2 id=conclusion>Conclusion</h2><p>Fully sharing <code>prom-client</code> metrics between Next.js&rsquo;s <code>App Router</code> and <code>Pages Router</code> API routes is currently difficult. Alternative approaches need to be considered, such as performing independent metrics collection in each router or using an external service like Prometheus Pushgateway to aggregate metrics.</p></div><div class="ad-slot in-content my-3"><ins class=adsbygoogle style=display:block;text-align:center data-ad-layout=in-article data-ad-format=fluid data-ad-client=ca-pub-9558545098866170></ins><script>(adsbygoogle=window.adsbygoogle||[]).push({})</script></div><footer class=article-footer></footer><meta itemprop=wordCount content="535"><meta itemprop=url content="https://yuhi-sa.github.io/en/posts/20231124_t3/1/"></article><nav class="post-nav mt-5" aria-label="Post navigation"><a href=/en/posts/20230907_dh/1/ class="post-nav__item post-nav__item--prev"><span class="post-nav__label text-muted"><i class="fas fa-arrow-left me-1" aria-hidden=true></i>前の記事
</span><span class=post-nav__title>Diffie-Hellman Key Exchange Protocol: Theory and Python Implementation</span>
</a><a href=/en/posts/20231124_mtail/1/ class="post-nav__item post-nav__item--next"><span class="post-nav__label text-muted">次の記事<i class="fas fa-arrow-right ms-1" aria-hidden=true></i>
</span><span class=post-nav__title>Generating Prometheus Metrics from Logs with mtail</span></a></nav><section class="related-posts mt-5" aria-label="Related posts"><h2 class=related-posts__title>関連記事</h2><div class=related-posts__grid><article class=related-posts__item><h3 class=related-posts__item-title><a href=/en/posts/20231124_mtail/1/>Generating Prometheus Metrics from Logs with mtail</a></h3><div class=card-meta><time datetime=2023-11-24>November 24, 2023</time></div></article><article class=related-posts__item><h3 class=related-posts__item-title><a href=/en/posts/20221229_async_await/1/>JavaScript Asynchronous Processing: From Callbacks to Promise and Async/Await</a></h3><div class=card-meta><time datetime=2022-12-29>December 29, 2022</time></div></article><article class=related-posts__item><h3 class=related-posts__item-title><a href=/en/posts/20221111_react/1/>Building a React/TypeScript Development Environment with Webpack and Babel</a></h3><div class=card-meta><time datetime=2022-11-11>November 11, 2022</time></div></article></div></section><nav class="article-navigation mt-4" aria-label="Article navigation"><a href=/en/posts/ class="btn btn-outline-secondary btn-sm mb-3"><i class="fas fa-arrow-left me-1" aria-hidden=true></i>
Back to posts</a><nav aria-label="Breadcrumb navigation" class=breadcrumb-nav role=navigation><ol class=breadcrumb itemscope itemtype=https://schema.org/BreadcrumbList><li class=breadcrumb-item itemprop=itemListElement itemscope itemtype=https://schema.org/ListItem><a href=/en/ itemprop=item aria-label="Navigate to homepage"><i class="fas fa-home" aria-hidden=true></i>
<span itemprop=name>tomato blog</span>
</a><meta itemprop=position content="1"></li><li class=breadcrumb-item itemprop=itemListElement itemscope itemtype=https://schema.org/ListItem><a href=https://yuhi-sa.github.io/en/ itemprop=item aria-label="Navigate to tomato blog"><span itemprop=name>tomato blog</span>
</a><meta itemprop=position content="2"></li><li class=breadcrumb-item itemprop=itemListElement itemscope itemtype=https://schema.org/ListItem><a href=https://yuhi-sa.github.io/en/posts/ itemprop=item aria-label="Navigate to Posts"><span itemprop=name>Posts</span>
</a><meta itemprop=position content="3"></li><li class="breadcrumb-item active" aria-current=page itemprop=itemListElement itemscope itemtype=https://schema.org/ListItem><span itemprop=name>Technical Challenges of Sharing prom-client Metrics Between Next.js App Router and Pages Router</span>
<meta itemprop=position content="4"></li></ol></nav></nav></div></div></div></main><footer role=contentinfo class=site-footer><div class="container pt-4 pb-3" style="border-top:2px solid var(--accent,#e54d2e)"><div class="row justify-content-center"><div class="col-md-8 text-center"><p class="copyright-text text-muted mb-2">&copy;
2026
yuhi-sa.
All rights reserved.</p><p class="theme-attribution text-muted small mt-2 mb-0">Powered by
<a href=https://gohugo.io/ target=_blank rel=noopener class=text-decoration-none>Hugo</a>
with
<a href=https://github.com/yuhi-sa/tomatohugo target=_blank rel=noopener class=text-decoration-none>TomatoHugo</a></p></div></div></div></footer><script src=https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js integrity=sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz crossorigin=anonymous defer></script><script src=/js/dark-mode.min.3e457dc8346f064bee795e6f9b73e1516dcd059e750c521fe4b445f9ea9a7821.js integrity="sha256-PkV9yDRvBkvueV5vm3PhUW3NBZ51DFIf5LRF+eqaeCE=" defer></script><script>window.addEventListener("load",function(){const e=document.createElement("script");e.async=!0,e.src="https://www.googletagmanager.com/gtag/js?id=G-LN6QP6VVM3",document.head.appendChild(e),e.onload=function(){window.dataLayer=window.dataLayer||[];function e(){dataLayer.push(arguments)}e("js",new Date),e("config","G-LN6QP6VVM3")}})</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"WebPage","name":"Technical Challenges of Sharing prom-client Metrics Between Next.js App Router and Pages Router","url":"https:\/\/yuhi-sa.github.io\/en\/posts\/20231124_t3\/1\/","description":"Exploring the technical challenges of sharing prom-client metrics between Next.js App Router and Pages Router, caused by separate JavaScript contexts.","inLanguage":"en","isPartOf":{"@type":"WebSite","name":"tomato blog","url":"https:\/\/yuhi-sa.github.io\/"}}</script></body></html>