<!doctype html><html lang=en dir=ltr data-theme=light><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=theme-color content="#e74c3c"><meta name=format-detection content="telephone=no"><meta name=robots content="index,follow"><meta name=description content="A Python implementation of the Cubature Kalman Filter (CKF) for nonlinear state estimation, with a comparison to the UKF and a detailed derivation of cubature …"><meta name=author content="yuhi-sa"><link rel=canonical href=https://yuhi-sa.github.io/en/posts/20260215_ckf/1/><meta property="og:type" content="article"><meta property="og:title" content="Cubature Kalman Filter (CKF): Theory and Python Implementation"><meta property="og:description" content="A Python implementation of the Cubature Kalman Filter (CKF) for nonlinear state estimation, with a comparison to the UKF and a detailed derivation of cubature …"><meta property="og:url" content="https://yuhi-sa.github.io/en/posts/20260215_ckf/1/"><meta property="og:site_name" content="tomato blog"><meta property="og:locale" content="en"><meta property="og:image" content="https://yuhi-sa.github.io/ogp.jpeg"><meta property="og:image:width" content="1200"><meta property="og:image:height" content="630"><meta property="article:published_time" content="2026-02-15T10:00:00+09:00"><meta property="article:modified_time" content="2026-02-15T19:04:26+09:00"><meta property="article:tag" content="Machine Learning"><meta property="article:tag" content="Filtering"><meta property="article:tag" content="Python"><meta property="article:section" content="posts"><meta name=twitter:card content="summary_large_image"><meta name=twitter:title content="Cubature Kalman Filter (CKF): Theory and Python Implementation"><meta name=twitter:description content="A Python implementation of the Cubature Kalman Filter (CKF) for nonlinear state estimation, with a comparison to the UKF and a detailed derivation of cubature …"><meta name=twitter:image content="https://yuhi-sa.github.io/ogp.jpeg"><title>Cubature Kalman Filter (CKF): Theory and Python Implementation | tomato blog</title><link rel=preconnect href=https://fonts.googleapis.com><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=preconnect href=https://cdn.jsdelivr.net crossorigin><link rel=preconnect href=https://pagead2.googlesyndication.com crossorigin><link rel=dns-prefetch href=https://pagead2.googlesyndication.com><link rel=icon href=https://yuhi-sa.github.io/favicon.ico><link rel=alternate hreflang=ja href=https://yuhi-sa.github.io/posts/20260215_ckf/1/><link rel=alternate hreflang=en href=https://yuhi-sa.github.io/en/posts/20260215_ckf/1/><link rel=alternate hreflang=x-default href=https://yuhi-sa.github.io/en/posts/20260215_ckf/1/><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Cubature Kalman Filter (CKF): Theory and Python Implementation","description":"A Python implementation of the Cubature Kalman Filter (CKF) for nonlinear state estimation, with a comparison to the UKF and a detailed derivation of cubature points.","author":{"@type":"Person","name":"yuhi-sa","url":"https:\/\/yuhi-sa.github.io\/"},"publisher":{"@type":"Organization","name":"tomato blog","logo":{"@type":"ImageObject","url":"https:\/\/yuhi-sa.github.io\/ogp.jpeg"},"url":"https:\/\/yuhi-sa.github.io\/"},"datePublished":"2026-02-15T10:00:00\u002b09:00","dateModified":"2026-02-15T19:04:26\u002b09:00","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/yuhi-sa.github.io\/en\/posts\/20260215_ckf\/1\/"},"url":"https:\/\/yuhi-sa.github.io\/en\/posts\/20260215_ckf\/1\/","wordCount":1316,"keywords":["Machine Learning","Filtering","Python"],"articleSection":"Posts","inLanguage":"en","timeRequired":"PT7M"}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"tomato blog","item":"https:\/\/yuhi-sa.github.io\/en\/"},{"@type":"ListItem","position":2,"name":"Posts","item":"https:\/\/yuhi-sa.github.io\/en\/posts\/"},{"@type":"ListItem","position":3,"name":"Cubature Kalman Filter (CKF): Theory and Python Implementation"}]}</script><link rel=preconnect href=https://fonts.googleapis.com><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel=stylesheet><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css integrity="sha512-iecdLmaskl7CVkqkXNQ/ZH/XLlvWZOJyj7Yy7tcenmpD1ypASozpmT/E0iPtmFIB46ZmdtAc9eNBvH0H/ZpiBw==" crossorigin=anonymous referrerpolicy=no-referrer><link href=https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css rel=stylesheet integrity=sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH crossorigin=anonymous><link rel=stylesheet href=/css/variables.min.72a177faa7b12de55dcc39c4ab6b6392116718d5e2735dab0214511354ecb973.css integrity="sha256-cqF3+qexLeVdzDnEq2tjkhFnGNXic12rAhRRE1TsuXM=" crossorigin=anonymous><link rel=stylesheet href=/css/main.min.403a82b29e94ee6e7a39204b5082cdf8b4966cfb44115390da7d8867a5006acd.css integrity="sha256-QDqCsp6U7m56OSBLUILN+LSWbPtEEVOQ2n2IZ6UAas0=" crossorigin=anonymous><link rel=stylesheet href=/css/syntax.min.e379066489e20d5433ca35ac1f468fd9e8859705a62d77a79bb7379ac3613848.css integrity="sha256-43kGZIniDVQzyjWsH0aP2eiFlwWmLXenm7c3msNhOEg=" crossorigin=anonymous><style>body{font-family:-apple-system,BlinkMacSystemFont,inter,segoe ui,Roboto,sans-serif;line-height:1.5;color:#000;background:#fff}[data-theme=dark] body{color:#fff;background:#000}.container{max-width:768px;margin:0 auto;padding:0 1rem}</style><script src=https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js integrity=sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz crossorigin=anonymous defer></script><script src=/js/dark-mode.min.3e457dc8346f064bee795e6f9b73e1516dcd059e750c521fe4b445f9ea9a7821.js integrity="sha256-PkV9yDRvBkvueV5vm3PhUW3NBZ51DFIf5LRF+eqaeCE=" defer></script><script>window.addEventListener("load",function(){const e=document.createElement("script");e.async=!0,e.src="https://www.googletagmanager.com/gtag/js?id=G-LN6QP6VVM3",document.head.appendChild(e),e.onload=function(){window.dataLayer=window.dataLayer||[];function e(){dataLayer.push(arguments)}e("js",new Date),e("config","G-LN6QP6VVM3")}})</script><script>window.MathJax={tex:{inlineMath:[["\\(","\\)"]],displayMath:[["\\[","\\]"]],processEscapes:!0,processEnvironments:!0},options:{skipHtmlTags:["script","noscript","style","textarea","pre","code"],ignoreHtmlClass:"tex2jax_ignore",processHtmlClass:"tex2jax_process"}}</script><script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js id=mathjax-script async></script></head><body itemscope itemtype=https://schema.org/WebPage class=theme-tomatohugo><a href=#main-content class="skip-link sr-only sr-only-focusable" aria-label="Skip to main content">Skip to main content</a><header role=banner class=site-header><nav class="navbar navbar-expand-lg navbar-light bg-light" role=navigation aria-label="Main navigation"><div class=container><a class=navbar-brand href=https://yuhi-sa.github.io/ aria-label="Return to tomato blog homepage">tomato blog
</a><button class="navbar-toggler d-lg-none" type=button data-bs-toggle=collapse data-bs-target=#navbarNav aria-controls=navbarNav aria-expanded=false aria-label="Toggle navigation menu">
<span class=navbar-toggler-icon></span></button><div class="collapse navbar-collapse" id=navbarNav><ul class="navbar-nav ms-auto" role=menubar><li class=nav-item role=none><a class=nav-link href=https://yuhi-sa.github.io/en/ role=menuitem aria-label="Navigate to Blog">Blog</a></li><li class=nav-item role=none><a class=nav-link href=https://yuhi-sa.github.io/en/tags/ role=menuitem aria-label="Navigate to Tags">Tags</a></li><li class=nav-item role=none><a class=nav-link href=https://yuhi-sa.github.io/en/posts/about/ role=menuitem aria-label="Navigate to About">About</a></li><li class=nav-item role=none><a class=nav-link href=https://yuhi-sa.github.io/en/posts/privacy_policy/ role=menuitem aria-label="Navigate to Privacy policy">Privacy policy</a></li><li class=nav-item role=none><button id=darkModeToggle class="nav-link btn btn-link border-0" type=button role=menuitem aria-label="Toggle dark mode" title="Switch between light and dark themes">
<i class="fas fa-moon" id=darkModeIcon aria-hidden=true></i>
<span class="d-lg-none ms-2">ダークモード</span></button></li></ul></div></div></nav><script data-ad-client=ca-pub-9558545098866170 async crossorigin=anonymous src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></header><main id=main-content role=main class=site-main aria-label="Main content"><div class="container mt-4"><div class="row justify-content-center"><div class=col-lg-8><article itemscope itemtype=https://schema.org/Article><header class=article-header><h1 itemprop=headline>Cubature Kalman Filter (CKF): Theory and Python Implementation</h1><p class="lead article-description" itemprop=description>A Python implementation of the Cubature Kalman Filter (CKF) for nonlinear state estimation, with a comparison to the UKF and a detailed derivation of cubature points.</p><div class=article-meta><time datetime=2026-02-15T10:00:00+09:00 itemprop=datePublished><i class="far fa-calendar-alt me-1" aria-hidden=true></i>
February 15, 2026
</time><time datetime=2026-02-15T19:04:26+09:00 itemprop=dateModified class=ms-3><i class="far fa-edit me-1" aria-hidden=true></i>
Updated
February 15, 2026
</time><span aria-label="Reading time" class=ms-3><i class="far fa-clock me-1" aria-hidden=true></i>
7 min read</span></div><div class=article-tags role=group aria-label="Article tags"><a href=/en/tags/machine-learning/ class="badge badge-custom text-decoration-none me-1" rel=tag itemprop=keywords>Machine Learning
</a><a href=/en/tags/filtering/ class="badge badge-custom text-decoration-none me-1" rel=tag itemprop=keywords>Filtering
</a><a href=/en/tags/python/ class="badge badge-custom text-decoration-none me-1" rel=tag itemprop=keywords>Python</a></div></header><div class=article-content itemprop=articleBody><h2 id=what-is-the-cubature-kalman-filter>What is the Cubature Kalman Filter?</h2><p>In the article on <a href=https://yuhi-sa.github.io/en/posts/20210125_ut/1/>Unscented Transformation (UT)</a>, we introduced a method for efficiently estimating the mean and covariance of nonlinearly transformed random variables using sigma points. The Unscented Kalman Filter (UKF) applies this UT to the prediction and update steps of a Kalman filter.</p><p>However, UKF has the following drawbacks:</p><ul><li>Requires tuning parameters \(\alpha, \beta, \kappa\)</li><li>In high dimensions, weights can become negative, compromising the positive definiteness of the covariance matrix</li></ul><p>The <strong>Cubature Kalman Filter (CKF)</strong> solves these problems by selecting sigma points (cubature points) based on the <strong>spherical-radial cubature rule</strong>. CKF requires no parameter tuning, and all weights are positive, ensuring numerical stability.</p><p>Reference: Arasaratnam, I., & Haykin, S. (2009). &ldquo;Cubature Kalman Filters.&rdquo; <em>IEEE Transactions on Automatic Control</em>, 54(6), 1254-1269.</p><h2 id=theory>Theory</h2><h3 id=gaussian-weighted-integrals>Gaussian-Weighted Integrals</h3><p>In nonlinear filtering, we need to compute Gaussian-weighted integrals of the form:</p>\[
I = \int_{\mathbb{R}^n} f(\mathbf{x}) \cdot \mathcal{N}(\mathbf{x}; \boldsymbol{\mu}, \mathbf{P}) \, d\mathbf{x}
\]<p>Using the substitution \(\mathbf{x} = \sqrt{\mathbf{P}} \mathbf{z} + \boldsymbol{\mu}\), this becomes an integral over the standard normal distribution:</p>\[
I = \int_{\mathbb{R}^n} f(\sqrt{\mathbf{P}} \mathbf{z} + \boldsymbol{\mu}) \cdot \mathcal{N}(\mathbf{z}; \mathbf{0}, \mathbf{I}) \, d\mathbf{z}
\]<h3 id=spherical-radial-cubature-rule>Spherical-Radial Cubature Rule</h3><p>The integral over the standard normal distribution is decomposed into spherical and radial components. Setting \(\mathbf{z} = r \mathbf{s}\) (where \(r = \|\mathbf{z}\|\) and \(\mathbf{s} = \mathbf{z}/\|\mathbf{z}\|\)):</p>\[
I = \int_0^{\infty} \int_{U_n} f(r \mathbf{s}) \cdot r^{n-1} e^{-r^2/2} \, d\sigma(\mathbf{s}) \, dr \cdot \frac{1}{(2\pi)^{n/2}}
\]<p>where \(U_n\) is the \(n\)-dimensional unit sphere and \(d\sigma(\mathbf{s})\) is the surface area element.</p><p>The <strong>third-degree cubature rule</strong> uses \(2n\) points on the sphere:</p>\[
\boldsymbol{\xi}_i = \sqrt{n} \, \mathbf{e}_i, \quad i = 1, \ldots, 2n
\]<p>where \(\mathbf{e}_i\) are defined as:</p>\[
\mathbf{e}_i = \begin{cases} \text{the } i\text{-th unit vector} & i = 1, \ldots, n \\\ -\text{the } (i-n)\text{-th unit vector} & i = n+1, \ldots, 2n \end{cases}
\]<p>All cubature point weights are equal:</p>\[
w_i = \frac{1}{2n}, \quad i = 1, \ldots, 2n \tag{1}
\]<h3 id=cubature-point-generation>Cubature Point Generation</h3><p>Given the mean \(\boldsymbol{\mu}\) and covariance \(\mathbf{P}\) of the state \(\mathbf{x}\), cubature points are computed as:</p>\[
\mathbf{X}_i = \sqrt{\mathbf{P}} \, \boldsymbol{\xi}_i + \boldsymbol{\mu}, \quad i = 1, \ldots, 2n \tag{2}
\]<p>where \(\sqrt{\mathbf{P}}\) is the matrix square root via Cholesky decomposition.</p><h3 id=comparison-with-ukf>Comparison with UKF</h3><table><thead><tr><th></th><th>UKF</th><th>CKF</th></tr></thead><tbody><tr><td>Number of points</td><td>\(2n + 1\)</td><td>\(2n\)</td></tr><tr><td>Parameters</td><td>\(\alpha, \beta, \kappa\)</td><td>None</td></tr><tr><td>Weights</td><td>Can be negative</td><td>All positive (\(1/2n\))</td></tr><tr><td>Theoretical basis</td><td>Heuristic</td><td>Cubature rule</td></tr></tbody></table><p>CKF can also be interpreted as a special case of UKF with \(\alpha=1, \beta=0, \kappa=0\).</p><h2 id=ckf-algorithm>CKF Algorithm</h2><p>State-space model:</p>\[
\mathbf{x}_k = f(\mathbf{x}_{k-1}) + \mathbf{w}_{k-1}, \quad \mathbf{w}_{k-1} \sim \mathcal{N}(\mathbf{0}, \mathbf{Q})
\]\[
\mathbf{y}_k = h(\mathbf{x}_k) + \mathbf{v}_k, \quad \mathbf{v}_k \sim \mathcal{N}(\mathbf{0}, \mathbf{R})
\]<h3 id=prediction-step>Prediction Step</h3><p><strong>1. Generate cubature points:</strong></p>\[
\mathbf{X}_{i,k-1} = \sqrt{\mathbf{P}_{k-1}} \, \boldsymbol{\xi}_i + \hat{\mathbf{x}}_{k-1}, \quad i = 1, \ldots, 2n \tag{3}
\]<p><strong>2. Propagate cubature points:</strong></p>\[
\mathbf{X}_{i,k|k-1}^{*} = f(\mathbf{X}_{i,k-1}) \tag{4}
\]<p><strong>3. Predicted mean:</strong></p>\[
\hat{\mathbf{x}}_{k|k-1} = \frac{1}{2n} \sum_{i=1}^{2n} \mathbf{X}_{i,k|k-1}^{*} \tag{5}
\]<p><strong>4. Predicted covariance:</strong></p>\[
\mathbf{P}_{k|k-1} = \frac{1}{2n} \sum_{i=1}^{2n} \mathbf{X}_{i,k|k-1}^{*} (\mathbf{X}_{i,k|k-1}^{*})^T - \hat{\mathbf{x}}_{k|k-1} \hat{\mathbf{x}}_{k|k-1}^T + \mathbf{Q} \tag{6}
\]<h3 id=update-step>Update Step</h3><p><strong>5. Regenerate cubature points:</strong></p>\[
\mathbf{X}_{i,k|k-1} = \sqrt{\mathbf{P}_{k|k-1}} \, \boldsymbol{\xi}_i + \hat{\mathbf{x}}_{k|k-1}, \quad i = 1, \ldots, 2n \tag{7}
\]<p><strong>6. Observation cubature points:</strong></p>\[
\mathbf{Y}_{i,k|k-1} = h(\mathbf{X}_{i,k|k-1}) \tag{8}
\]<p><strong>7. Predicted observation mean:</strong></p>\[
\hat{\mathbf{y}}_{k|k-1} = \frac{1}{2n} \sum_{i=1}^{2n} \mathbf{Y}_{i,k|k-1} \tag{9}
\]<p><strong>8. Innovation covariance and cross-covariance:</strong></p>\[
\mathbf{S}_k = \frac{1}{2n} \sum_{i=1}^{2n} \mathbf{Y}_{i,k|k-1} \mathbf{Y}_{i,k|k-1}^T - \hat{\mathbf{y}}_{k|k-1} \hat{\mathbf{y}}_{k|k-1}^T + \mathbf{R} \tag{10}
\]\[
\mathbf{C}_k = \frac{1}{2n} \sum_{i=1}^{2n} \mathbf{X}_{i,k|k-1} \mathbf{Y}_{i,k|k-1}^T - \hat{\mathbf{x}}_{k|k-1} \hat{\mathbf{y}}_{k|k-1}^T \tag{11}
\]<p><strong>9. Kalman gain and state update:</strong></p>\[
\mathbf{K}_k = \mathbf{C}_k \mathbf{S}_k^{-1} \tag{12}
\]\[
\hat{\mathbf{x}}_k = \hat{\mathbf{x}}_{k|k-1} + \mathbf{K}_k (\mathbf{y}_k - \hat{\mathbf{y}}_{k|k-1}) \tag{13}
\]\[
\mathbf{P}_k = \mathbf{P}_{k|k-1} - \mathbf{K}_k \mathbf{S}_k \mathbf{K}_k^T \tag{14}
\]<h2 id=python-implementation>Python Implementation</h2><p>We implement CKF using a coordinated turn model in 2D.</p><h3 id=state-space-model-definition>State-Space Model Definition</h3><p>The state vector is \(\mathbf{x} = [p_x, p_y, v, \theta]^T\) (position, velocity, heading angle) with the following nonlinear transition model:</p>\[
f(\mathbf{x}) = \begin{bmatrix} p_x + \frac{v}{\omega}\sin(\theta + \omega \Delta t) - \frac{v}{\omega}\sin\theta \\\ p_y - \frac{v}{\omega}\cos(\theta + \omega \Delta t) + \frac{v}{\omega}\cos\theta \\\ v \\\ \theta + \omega \Delta t \end{bmatrix}
\]<p>The observation model assumes only the position is measurable: \(h(\mathbf{x}) = [p_x, p_y]^T\).</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>numpy</span> <span class=k>as</span> <span class=nn>np</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>scipy.linalg</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>matplotlib.pyplot</span> <span class=k>as</span> <span class=nn>plt</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># ---- State-space model definition ----</span>
</span></span><span class=line><span class=cl><span class=n>dt</span> <span class=o>=</span> <span class=mf>1.0</span>
</span></span><span class=line><span class=cl><span class=n>omega</span> <span class=o>=</span> <span class=mf>0.05</span>  <span class=c1># turn rate [rad/s]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>f</span><span class=p>(</span><span class=n>x</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;Nonlinear state transition function (coordinated turn model)&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>px</span><span class=p>,</span> <span class=n>py</span><span class=p>,</span> <span class=n>v</span><span class=p>,</span> <span class=n>theta</span> <span class=o>=</span> <span class=n>x</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=nb>abs</span><span class=p>(</span><span class=n>omega</span><span class=p>)</span> <span class=o>&lt;</span> <span class=mf>1e-6</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>np</span><span class=o>.</span><span class=n>array</span><span class=p>([</span><span class=n>px</span> <span class=o>+</span> <span class=n>v</span> <span class=o>*</span> <span class=n>np</span><span class=o>.</span><span class=n>cos</span><span class=p>(</span><span class=n>theta</span><span class=p>)</span> <span class=o>*</span> <span class=n>dt</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                         <span class=n>py</span> <span class=o>+</span> <span class=n>v</span> <span class=o>*</span> <span class=n>np</span><span class=o>.</span><span class=n>sin</span><span class=p>(</span><span class=n>theta</span><span class=p>)</span> <span class=o>*</span> <span class=n>dt</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                         <span class=n>v</span><span class=p>,</span> <span class=n>theta</span><span class=p>])</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>np</span><span class=o>.</span><span class=n>array</span><span class=p>([</span>
</span></span><span class=line><span class=cl>        <span class=n>px</span> <span class=o>+</span> <span class=n>v</span> <span class=o>/</span> <span class=n>omega</span> <span class=o>*</span> <span class=p>(</span><span class=n>np</span><span class=o>.</span><span class=n>sin</span><span class=p>(</span><span class=n>theta</span> <span class=o>+</span> <span class=n>omega</span> <span class=o>*</span> <span class=n>dt</span><span class=p>)</span> <span class=o>-</span> <span class=n>np</span><span class=o>.</span><span class=n>sin</span><span class=p>(</span><span class=n>theta</span><span class=p>)),</span>
</span></span><span class=line><span class=cl>        <span class=n>py</span> <span class=o>-</span> <span class=n>v</span> <span class=o>/</span> <span class=n>omega</span> <span class=o>*</span> <span class=p>(</span><span class=n>np</span><span class=o>.</span><span class=n>cos</span><span class=p>(</span><span class=n>theta</span> <span class=o>+</span> <span class=n>omega</span> <span class=o>*</span> <span class=n>dt</span><span class=p>)</span> <span class=o>-</span> <span class=n>np</span><span class=o>.</span><span class=n>cos</span><span class=p>(</span><span class=n>theta</span><span class=p>)),</span>
</span></span><span class=line><span class=cl>        <span class=n>v</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>theta</span> <span class=o>+</span> <span class=n>omega</span> <span class=o>*</span> <span class=n>dt</span>
</span></span><span class=line><span class=cl>    <span class=p>])</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>h</span><span class=p>(</span><span class=n>x</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;Observation function (position only)&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>np</span><span class=o>.</span><span class=n>array</span><span class=p>([</span><span class=n>x</span><span class=p>[</span><span class=mi>0</span><span class=p>],</span> <span class=n>x</span><span class=p>[</span><span class=mi>1</span><span class=p>]])</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>n</span> <span class=o>=</span> <span class=mi>4</span>   <span class=c1># state dimension</span>
</span></span><span class=line><span class=cl><span class=n>m</span> <span class=o>=</span> <span class=mi>2</span>   <span class=c1># observation dimension</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Process noise and observation noise</span>
</span></span><span class=line><span class=cl><span class=n>Q</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>diag</span><span class=p>([</span><span class=mf>0.1</span><span class=p>,</span> <span class=mf>0.1</span><span class=p>,</span> <span class=mf>0.01</span><span class=p>,</span> <span class=mf>0.001</span><span class=p>])</span>
</span></span><span class=line><span class=cl><span class=n>R</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>diag</span><span class=p>([</span><span class=mf>1.0</span><span class=p>,</span> <span class=mf>1.0</span><span class=p>])</span>
</span></span></code></pre></div><h3 id=ckf-implementation>CKF Implementation</h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>def</span> <span class=nf>generate_cubature_points</span><span class=p>(</span><span class=n>mu</span><span class=p>,</span> <span class=n>P</span><span class=p>,</span> <span class=n>n</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;Generate cubature points (Eq. 2)&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>num_points</span> <span class=o>=</span> <span class=mi>2</span> <span class=o>*</span> <span class=n>n</span>
</span></span><span class=line><span class=cl>    <span class=n>sqrt_P</span> <span class=o>=</span> <span class=n>scipy</span><span class=o>.</span><span class=n>linalg</span><span class=o>.</span><span class=n>cholesky</span><span class=p>(</span><span class=n>n</span> <span class=o>*</span> <span class=n>P</span><span class=p>,</span> <span class=n>lower</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>points</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>zeros</span><span class=p>((</span><span class=n>n</span><span class=p>,</span> <span class=n>num_points</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>n</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>points</span><span class=p>[:,</span> <span class=n>i</span><span class=p>]</span> <span class=o>=</span> <span class=n>mu</span> <span class=o>+</span> <span class=n>sqrt_P</span><span class=p>[:,</span> <span class=n>i</span><span class=p>]</span>       <span class=c1># +sqrt(nP) columns</span>
</span></span><span class=line><span class=cl>        <span class=n>points</span><span class=p>[:,</span> <span class=n>n</span> <span class=o>+</span> <span class=n>i</span><span class=p>]</span> <span class=o>=</span> <span class=n>mu</span> <span class=o>-</span> <span class=n>sqrt_P</span><span class=p>[:,</span> <span class=n>i</span><span class=p>]</span>   <span class=c1># -sqrt(nP) columns</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>points</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>ckf_predict</span><span class=p>(</span><span class=n>x_est</span><span class=p>,</span> <span class=n>P_est</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;CKF prediction step&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=c1># Eq. 3: Generate cubature points</span>
</span></span><span class=line><span class=cl>    <span class=n>X</span> <span class=o>=</span> <span class=n>generate_cubature_points</span><span class=p>(</span><span class=n>x_est</span><span class=p>,</span> <span class=n>P_est</span><span class=p>,</span> <span class=n>n</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>num_points</span> <span class=o>=</span> <span class=mi>2</span> <span class=o>*</span> <span class=n>n</span>
</span></span><span class=line><span class=cl>    <span class=n>w</span> <span class=o>=</span> <span class=mf>1.0</span> <span class=o>/</span> <span class=n>num_points</span>  <span class=c1># Eq. 1: equal weights</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># Eq. 4: Nonlinear transformation</span>
</span></span><span class=line><span class=cl>    <span class=n>X_pred</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>zeros_like</span><span class=p>(</span><span class=n>X</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>num_points</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>X_pred</span><span class=p>[:,</span> <span class=n>i</span><span class=p>]</span> <span class=o>=</span> <span class=n>f</span><span class=p>(</span><span class=n>X</span><span class=p>[:,</span> <span class=n>i</span><span class=p>])</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># Eq. 5: Predicted mean</span>
</span></span><span class=line><span class=cl>    <span class=n>x_pred</span> <span class=o>=</span> <span class=n>w</span> <span class=o>*</span> <span class=n>np</span><span class=o>.</span><span class=n>sum</span><span class=p>(</span><span class=n>X_pred</span><span class=p>,</span> <span class=n>axis</span><span class=o>=</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># Eq. 6: Predicted covariance</span>
</span></span><span class=line><span class=cl>    <span class=n>P_pred</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>zeros</span><span class=p>((</span><span class=n>n</span><span class=p>,</span> <span class=n>n</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>num_points</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>diff</span> <span class=o>=</span> <span class=n>X_pred</span><span class=p>[:,</span> <span class=n>i</span><span class=p>]</span> <span class=o>-</span> <span class=n>x_pred</span>
</span></span><span class=line><span class=cl>        <span class=n>P_pred</span> <span class=o>+=</span> <span class=n>w</span> <span class=o>*</span> <span class=n>np</span><span class=o>.</span><span class=n>outer</span><span class=p>(</span><span class=n>diff</span><span class=p>,</span> <span class=n>diff</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>P_pred</span> <span class=o>+=</span> <span class=n>Q</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>x_pred</span><span class=p>,</span> <span class=n>P_pred</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>ckf_update</span><span class=p>(</span><span class=n>x_pred</span><span class=p>,</span> <span class=n>P_pred</span><span class=p>,</span> <span class=n>y</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;CKF update step&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=c1># Eq. 7: Regenerate cubature points</span>
</span></span><span class=line><span class=cl>    <span class=n>X</span> <span class=o>=</span> <span class=n>generate_cubature_points</span><span class=p>(</span><span class=n>x_pred</span><span class=p>,</span> <span class=n>P_pred</span><span class=p>,</span> <span class=n>n</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>num_points</span> <span class=o>=</span> <span class=mi>2</span> <span class=o>*</span> <span class=n>n</span>
</span></span><span class=line><span class=cl>    <span class=n>w</span> <span class=o>=</span> <span class=mf>1.0</span> <span class=o>/</span> <span class=n>num_points</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># Eq. 8: Observation cubature points</span>
</span></span><span class=line><span class=cl>    <span class=n>Y</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>zeros</span><span class=p>((</span><span class=n>m</span><span class=p>,</span> <span class=n>num_points</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>num_points</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>Y</span><span class=p>[:,</span> <span class=n>i</span><span class=p>]</span> <span class=o>=</span> <span class=n>h</span><span class=p>(</span><span class=n>X</span><span class=p>[:,</span> <span class=n>i</span><span class=p>])</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># Eq. 9: Predicted observation mean</span>
</span></span><span class=line><span class=cl>    <span class=n>y_pred</span> <span class=o>=</span> <span class=n>w</span> <span class=o>*</span> <span class=n>np</span><span class=o>.</span><span class=n>sum</span><span class=p>(</span><span class=n>Y</span><span class=p>,</span> <span class=n>axis</span><span class=o>=</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># Eq. 10: Innovation covariance</span>
</span></span><span class=line><span class=cl>    <span class=n>S</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>zeros</span><span class=p>((</span><span class=n>m</span><span class=p>,</span> <span class=n>m</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>num_points</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>dy</span> <span class=o>=</span> <span class=n>Y</span><span class=p>[:,</span> <span class=n>i</span><span class=p>]</span> <span class=o>-</span> <span class=n>y_pred</span>
</span></span><span class=line><span class=cl>        <span class=n>S</span> <span class=o>+=</span> <span class=n>w</span> <span class=o>*</span> <span class=n>np</span><span class=o>.</span><span class=n>outer</span><span class=p>(</span><span class=n>dy</span><span class=p>,</span> <span class=n>dy</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>S</span> <span class=o>+=</span> <span class=n>R</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># Eq. 11: Cross-covariance</span>
</span></span><span class=line><span class=cl>    <span class=n>C</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>zeros</span><span class=p>((</span><span class=n>n</span><span class=p>,</span> <span class=n>m</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>num_points</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>dx</span> <span class=o>=</span> <span class=n>X</span><span class=p>[:,</span> <span class=n>i</span><span class=p>]</span> <span class=o>-</span> <span class=n>x_pred</span>
</span></span><span class=line><span class=cl>        <span class=n>dy</span> <span class=o>=</span> <span class=n>Y</span><span class=p>[:,</span> <span class=n>i</span><span class=p>]</span> <span class=o>-</span> <span class=n>y_pred</span>
</span></span><span class=line><span class=cl>        <span class=n>C</span> <span class=o>+=</span> <span class=n>w</span> <span class=o>*</span> <span class=n>np</span><span class=o>.</span><span class=n>outer</span><span class=p>(</span><span class=n>dx</span><span class=p>,</span> <span class=n>dy</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># Eq. 12-14: Kalman gain and state update</span>
</span></span><span class=line><span class=cl>    <span class=n>K</span> <span class=o>=</span> <span class=n>C</span> <span class=o>@</span> <span class=n>np</span><span class=o>.</span><span class=n>linalg</span><span class=o>.</span><span class=n>inv</span><span class=p>(</span><span class=n>S</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>x_est</span> <span class=o>=</span> <span class=n>x_pred</span> <span class=o>+</span> <span class=n>K</span> <span class=o>@</span> <span class=p>(</span><span class=n>y</span> <span class=o>-</span> <span class=n>y_pred</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>P_est</span> <span class=o>=</span> <span class=n>P_pred</span> <span class=o>-</span> <span class=n>K</span> <span class=o>@</span> <span class=n>S</span> <span class=o>@</span> <span class=n>K</span><span class=o>.</span><span class=n>T</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>x_est</span><span class=p>,</span> <span class=n>P_est</span>
</span></span></code></pre></div><h3 id=simulation>Simulation</h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>np</span><span class=o>.</span><span class=n>random</span><span class=o>.</span><span class=n>seed</span><span class=p>(</span><span class=mi>42</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>T</span> <span class=o>=</span> <span class=mi>100</span>  <span class=c1># number of time steps</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># True initial state</span>
</span></span><span class=line><span class=cl><span class=n>x_true</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>array</span><span class=p>([</span><span class=mf>0.0</span><span class=p>,</span> <span class=mf>0.0</span><span class=p>,</span> <span class=mf>1.0</span><span class=p>,</span> <span class=n>np</span><span class=o>.</span><span class=n>pi</span> <span class=o>/</span> <span class=mi>2</span><span class=p>])</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># CKF initial estimate</span>
</span></span><span class=line><span class=cl><span class=n>x_est</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>array</span><span class=p>([</span><span class=mf>0.5</span><span class=p>,</span> <span class=o>-</span><span class=mf>0.5</span><span class=p>,</span> <span class=mf>0.8</span><span class=p>,</span> <span class=n>np</span><span class=o>.</span><span class=n>pi</span> <span class=o>/</span> <span class=mi>2</span> <span class=o>+</span> <span class=mf>0.1</span><span class=p>])</span>
</span></span><span class=line><span class=cl><span class=n>P_est</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>diag</span><span class=p>([</span><span class=mf>1.0</span><span class=p>,</span> <span class=mf>1.0</span><span class=p>,</span> <span class=mf>0.5</span><span class=p>,</span> <span class=mf>0.1</span><span class=p>])</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Storage arrays</span>
</span></span><span class=line><span class=cl><span class=n>true_states</span> <span class=o>=</span> <span class=p>[</span><span class=n>x_true</span><span class=o>.</span><span class=n>copy</span><span class=p>()]</span>
</span></span><span class=line><span class=cl><span class=n>measurements</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl><span class=n>estimates</span> <span class=o>=</span> <span class=p>[</span><span class=n>x_est</span><span class=o>.</span><span class=n>copy</span><span class=p>()]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>k</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>T</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=c1># Update true state</span>
</span></span><span class=line><span class=cl>    <span class=n>x_true</span> <span class=o>=</span> <span class=n>f</span><span class=p>(</span><span class=n>x_true</span><span class=p>)</span> <span class=o>+</span> <span class=n>np</span><span class=o>.</span><span class=n>random</span><span class=o>.</span><span class=n>multivariate_normal</span><span class=p>(</span><span class=n>np</span><span class=o>.</span><span class=n>zeros</span><span class=p>(</span><span class=n>n</span><span class=p>),</span> <span class=n>Q</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>true_states</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>x_true</span><span class=o>.</span><span class=n>copy</span><span class=p>())</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># Generate measurement</span>
</span></span><span class=line><span class=cl>    <span class=n>y</span> <span class=o>=</span> <span class=n>h</span><span class=p>(</span><span class=n>x_true</span><span class=p>)</span> <span class=o>+</span> <span class=n>np</span><span class=o>.</span><span class=n>random</span><span class=o>.</span><span class=n>multivariate_normal</span><span class=p>(</span><span class=n>np</span><span class=o>.</span><span class=n>zeros</span><span class=p>(</span><span class=n>m</span><span class=p>),</span> <span class=n>R</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>measurements</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>y</span><span class=o>.</span><span class=n>copy</span><span class=p>())</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># CKF</span>
</span></span><span class=line><span class=cl>    <span class=n>x_est</span><span class=p>,</span> <span class=n>P_est</span> <span class=o>=</span> <span class=n>ckf_predict</span><span class=p>(</span><span class=n>x_est</span><span class=p>,</span> <span class=n>P_est</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>x_est</span><span class=p>,</span> <span class=n>P_est</span> <span class=o>=</span> <span class=n>ckf_update</span><span class=p>(</span><span class=n>x_est</span><span class=p>,</span> <span class=n>P_est</span><span class=p>,</span> <span class=n>y</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>estimates</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>x_est</span><span class=o>.</span><span class=n>copy</span><span class=p>())</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>true_states</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>array</span><span class=p>(</span><span class=n>true_states</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>measurements</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>array</span><span class=p>(</span><span class=n>measurements</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>estimates</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>array</span><span class=p>(</span><span class=n>estimates</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># ---- Plot results ----</span>
</span></span><span class=line><span class=cl><span class=n>plt</span><span class=o>.</span><span class=n>figure</span><span class=p>(</span><span class=n>figsize</span><span class=o>=</span><span class=p>(</span><span class=mi>10</span><span class=p>,</span> <span class=mi>8</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=n>plt</span><span class=o>.</span><span class=n>plot</span><span class=p>(</span><span class=n>true_states</span><span class=p>[:,</span> <span class=mi>0</span><span class=p>],</span> <span class=n>true_states</span><span class=p>[:,</span> <span class=mi>1</span><span class=p>],</span> <span class=s2>&#34;b-&#34;</span><span class=p>,</span> <span class=n>label</span><span class=o>=</span><span class=s2>&#34;True trajectory&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>plt</span><span class=o>.</span><span class=n>scatter</span><span class=p>(</span><span class=n>measurements</span><span class=p>[:,</span> <span class=mi>0</span><span class=p>],</span> <span class=n>measurements</span><span class=p>[:,</span> <span class=mi>1</span><span class=p>],</span>
</span></span><span class=line><span class=cl>            <span class=n>c</span><span class=o>=</span><span class=s2>&#34;gray&#34;</span><span class=p>,</span> <span class=n>s</span><span class=o>=</span><span class=mi>10</span><span class=p>,</span> <span class=n>alpha</span><span class=o>=</span><span class=mf>0.5</span><span class=p>,</span> <span class=n>label</span><span class=o>=</span><span class=s2>&#34;Measurements&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>plt</span><span class=o>.</span><span class=n>plot</span><span class=p>(</span><span class=n>estimates</span><span class=p>[:,</span> <span class=mi>0</span><span class=p>],</span> <span class=n>estimates</span><span class=p>[:,</span> <span class=mi>1</span><span class=p>],</span> <span class=s2>&#34;r--&#34;</span><span class=p>,</span> <span class=n>label</span><span class=o>=</span><span class=s2>&#34;CKF estimate&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>plt</span><span class=o>.</span><span class=n>xlabel</span><span class=p>(</span><span class=s2>&#34;x&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>plt</span><span class=o>.</span><span class=n>ylabel</span><span class=p>(</span><span class=s2>&#34;y&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>plt</span><span class=o>.</span><span class=n>title</span><span class=p>(</span><span class=s2>&#34;Cubature Kalman Filter - Coordinated Turn Tracking&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>plt</span><span class=o>.</span><span class=n>legend</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>plt</span><span class=o>.</span><span class=n>axis</span><span class=p>(</span><span class=s2>&#34;equal&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>plt</span><span class=o>.</span><span class=n>grid</span><span class=p>(</span><span class=kc>True</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>plt</span><span class=o>.</span><span class=n>tight_layout</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>plt</span><span class=o>.</span><span class=n>savefig</span><span class=p>(</span><span class=s2>&#34;ckf_result.png&#34;</span><span class=p>,</span> <span class=n>dpi</span><span class=o>=</span><span class=mi>150</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>plt</span><span class=o>.</span><span class=n>show</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># RMSE</span>
</span></span><span class=line><span class=cl><span class=n>rmse_x</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>sqrt</span><span class=p>(</span><span class=n>np</span><span class=o>.</span><span class=n>mean</span><span class=p>((</span><span class=n>true_states</span><span class=p>[</span><span class=mi>1</span><span class=p>:,</span> <span class=mi>0</span><span class=p>]</span> <span class=o>-</span> <span class=n>estimates</span><span class=p>[</span><span class=mi>1</span><span class=p>:,</span> <span class=mi>0</span><span class=p>])</span><span class=o>**</span><span class=mi>2</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=n>rmse_y</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>sqrt</span><span class=p>(</span><span class=n>np</span><span class=o>.</span><span class=n>mean</span><span class=p>((</span><span class=n>true_states</span><span class=p>[</span><span class=mi>1</span><span class=p>:,</span> <span class=mi>1</span><span class=p>]</span> <span class=o>-</span> <span class=n>estimates</span><span class=p>[</span><span class=mi>1</span><span class=p>:,</span> <span class=mi>1</span><span class=p>])</span><span class=o>**</span><span class=mi>2</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Position RMSE: x=</span><span class=si>{</span><span class=n>rmse_x</span><span class=si>:</span><span class=s2>.4f</span><span class=si>}</span><span class=s2>, y=</span><span class=si>{</span><span class=n>rmse_y</span><span class=si>:</span><span class=s2>.4f</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span></code></pre></div><p>CKF achieves stable estimation without any parameter tuning, making it particularly advantageous for high-dimensional problems where UKF may encounter numerical issues.</p><h2 id=references>References</h2><ul><li>Arasaratnam, I., & Haykin, S. (2009). &ldquo;Cubature Kalman Filters.&rdquo; <em>IEEE Transactions on Automatic Control</em>, 54(6), 1254-1269.</li><li>Katayama, T. (2011). &ldquo;Basics of Nonlinear Kalman Filters.&rdquo; <em>Journal of SICE</em>, 50(9), 638-643.</li></ul></div><div class="ad-slot in-content my-3"><ins class=adsbygoogle style=display:block;text-align:center data-ad-layout=in-article data-ad-format=fluid data-ad-client=ca-pub-9558545098866170></ins><script>(adsbygoogle=window.adsbygoogle||[]).push({})</script></div><footer class=article-footer></footer><meta itemprop=wordCount content="1316"><meta itemprop=url content="https://yuhi-sa.github.io/en/posts/20260215_ckf/1/"></article><nav class="post-nav mt-5" aria-label="Post navigation"><a href=/en/posts/20260125_prisma_jst/1/ class="post-nav__item post-nav__item--prev"><span class="post-nav__label text-muted"><i class="fas fa-arrow-left me-1" aria-hidden=true></i>前の記事
</span><span class=post-nav__title>Resolving Timezone Mismatch Issues Between Prisma and MySQL</span>
</a><a href=/en/posts/20260215_mppi/1/ class="post-nav__item post-nav__item--next"><span class="post-nav__label text-muted">次の記事<i class="fas fa-arrow-right ms-1" aria-hidden=true></i>
</span><span class=post-nav__title>MPPI (Model Predictive Path Integral): A Unified View with the Cross-Entropy Method</span></a></nav><section class="related-posts mt-5" aria-label="Related posts"><h2 class=related-posts__title>関連記事</h2><div class=related-posts__grid><article class=related-posts__item><h3 class=related-posts__item-title><a href=/en/posts/20260228_timeseries_anomaly/1/>Time-Series Anomaly Detection: From Statistical Methods to Kalman Filter in Python</a></h3><div class=card-meta><time datetime=2026-02-28>February 28, 2026</time></div></article><article class=related-posts__item><h3 class=related-posts__item-title><a href=/en/posts/20260224_ekf/1/>Extended Kalman Filter (EKF): Theory and Python Implementation</a></h3><div class=card-meta><time datetime=2026-02-24>February 24, 2026</time></div></article><article class=related-posts__item><h3 class=related-posts__item-title><a href=/en/posts/20260224_kalman_filter/1/>Kalman Filter: Theory and Python Implementation</a></h3><div class=card-meta><time datetime=2026-02-24>February 24, 2026</time></div></article></div></section><nav class="article-navigation mt-4" aria-label="Article navigation"><a href=/en/posts/ class="btn btn-outline-secondary btn-sm mb-3"><i class="fas fa-arrow-left me-1" aria-hidden=true></i>
Back to posts</a><nav aria-label="Breadcrumb navigation" class=breadcrumb-nav role=navigation><ol class=breadcrumb itemscope itemtype=https://schema.org/BreadcrumbList><li class=breadcrumb-item itemprop=itemListElement itemscope itemtype=https://schema.org/ListItem><a href=/en/ itemprop=item aria-label="Navigate to homepage"><i class="fas fa-home" aria-hidden=true></i>
<span itemprop=name>tomato blog</span>
</a><meta itemprop=position content="1"></li><li class=breadcrumb-item itemprop=itemListElement itemscope itemtype=https://schema.org/ListItem><a href=https://yuhi-sa.github.io/en/ itemprop=item aria-label="Navigate to tomato blog"><span itemprop=name>tomato blog</span>
</a><meta itemprop=position content="2"></li><li class=breadcrumb-item itemprop=itemListElement itemscope itemtype=https://schema.org/ListItem><a href=https://yuhi-sa.github.io/en/posts/ itemprop=item aria-label="Navigate to Posts"><span itemprop=name>Posts</span>
</a><meta itemprop=position content="3"></li><li class="breadcrumb-item active" aria-current=page itemprop=itemListElement itemscope itemtype=https://schema.org/ListItem><span itemprop=name>Cubature Kalman Filter (CKF): Theory and Python Implementation</span>
<meta itemprop=position content="4"></li></ol></nav></nav></div></div></div></main><footer role=contentinfo class=site-footer><div class="container pt-4 pb-3" style="border-top:2px solid var(--accent,#e54d2e)"><div class="row justify-content-center"><div class="col-md-8 text-center"><p class="copyright-text text-muted mb-2">&copy; 2026 yuhi-sa. All rights reserved.</p><p class="theme-attribution text-muted small mt-2 mb-0">Powered by
<a href=https://gohugo.io/ target=_blank rel=noopener class=text-decoration-none>Hugo</a>
with
<a href=https://github.com/yuhi-sa/tomatohugo target=_blank rel=noopener class=text-decoration-none>TomatoHugo</a></p></div></div></div></footer><script src=https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js integrity=sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz crossorigin=anonymous defer></script><script src=/js/dark-mode.min.3e457dc8346f064bee795e6f9b73e1516dcd059e750c521fe4b445f9ea9a7821.js integrity="sha256-PkV9yDRvBkvueV5vm3PhUW3NBZ51DFIf5LRF+eqaeCE=" defer></script><script>window.addEventListener("load",function(){const e=document.createElement("script");e.async=!0,e.src="https://www.googletagmanager.com/gtag/js?id=G-LN6QP6VVM3",document.head.appendChild(e),e.onload=function(){window.dataLayer=window.dataLayer||[];function e(){dataLayer.push(arguments)}e("js",new Date),e("config","G-LN6QP6VVM3")}})</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"WebPage","name":"Cubature Kalman Filter (CKF): Theory and Python Implementation","url":"https:\/\/yuhi-sa.github.io\/en\/posts\/20260215_ckf\/1\/","description":"A Python implementation of the Cubature Kalman Filter (CKF) for nonlinear state estimation, with a comparison to the UKF and a detailed derivation of cubature points.","inLanguage":"en","isPartOf":{"@type":"WebSite","name":"tomato blog","url":"https:\/\/yuhi-sa.github.io\/"}}</script></body></html>