<!doctype html><html lang=en dir=ltr data-theme=light><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=theme-color content="#e74c3c"><meta name=format-detection content="telephone=no"><meta name=robots content="index,follow"><meta name=description content="A Python implementation of the Rauch-Tung-Striebel (RTS) smoother with mathematical derivation and accuracy comparison against the Kalman filter."><meta name=author content="yuhi-sa"><link rel=canonical href=https://yuhi-sa.github.io/en/posts/20260223_rts_smoother/1/><meta property="og:type" content="article"><meta property="og:title" content="Kalman Smoother (RTS Smoother): Theory and Python Implementation"><meta property="og:description" content="A Python implementation of the Rauch-Tung-Striebel (RTS) smoother with mathematical derivation and accuracy comparison against the Kalman filter."><meta property="og:url" content="https://yuhi-sa.github.io/en/posts/20260223_rts_smoother/1/"><meta property="og:site_name" content="tomato blog"><meta property="og:locale" content="en"><meta property="og:image" content="https://yuhi-sa.github.io/ogp.jpeg"><meta property="og:image:width" content="1200"><meta property="og:image:height" content="630"><meta property="article:published_time" content="2026-02-23T15:00:00+09:00"><meta property="article:modified_time" content="2026-02-23T20:44:30+09:00"><meta property="article:tag" content="Machine Learning"><meta property="article:tag" content="Filtering"><meta property="article:tag" content="Signal Processing"><meta property="article:tag" content="Python"><meta property="article:section" content="posts"><meta name=twitter:card content="summary_large_image"><meta name=twitter:title content="Kalman Smoother (RTS Smoother): Theory and Python Implementation"><meta name=twitter:description content="A Python implementation of the Rauch-Tung-Striebel (RTS) smoother with mathematical derivation and accuracy comparison against the Kalman filter."><meta name=twitter:image content="https://yuhi-sa.github.io/ogp.jpeg"><title>Kalman Smoother (RTS Smoother): Theory and Python Implementation | tomato blog</title><link rel=preconnect href=https://fonts.googleapis.com><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=preconnect href=https://cdn.jsdelivr.net crossorigin><link rel=preconnect href=https://pagead2.googlesyndication.com crossorigin><link rel=dns-prefetch href=https://pagead2.googlesyndication.com><link rel=icon href=https://yuhi-sa.github.io/favicon.ico><link rel=alternate hreflang=ja href=https://yuhi-sa.github.io/posts/20260223_rts_smoother/1/><link rel=alternate hreflang=en href=https://yuhi-sa.github.io/en/posts/20260223_rts_smoother/1/><link rel=alternate hreflang=x-default href=https://yuhi-sa.github.io/en/posts/20260223_rts_smoother/1/><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Kalman Smoother (RTS Smoother): Theory and Python Implementation","description":"A Python implementation of the Rauch-Tung-Striebel (RTS) smoother with mathematical derivation and accuracy comparison against the Kalman filter.","author":{"@type":"Person","name":"yuhi-sa","url":"https:\/\/yuhi-sa.github.io\/"},"publisher":{"@type":"Organization","name":"tomato blog","logo":{"@type":"ImageObject","url":"https:\/\/yuhi-sa.github.io\/ogp.jpeg"},"url":"https:\/\/yuhi-sa.github.io\/"},"datePublished":"2026-02-23T15:00:00\u002b09:00","dateModified":"2026-02-23T20:44:30\u002b09:00","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/yuhi-sa.github.io\/en\/posts\/20260223_rts_smoother\/1\/"},"url":"https:\/\/yuhi-sa.github.io\/en\/posts\/20260223_rts_smoother\/1\/","wordCount":1410,"keywords":["Machine Learning","Filtering","Signal Processing","Python"],"articleSection":"Posts","inLanguage":"en","timeRequired":"PT7M"}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"tomato blog","item":"https:\/\/yuhi-sa.github.io\/en\/"},{"@type":"ListItem","position":2,"name":"Posts","item":"https:\/\/yuhi-sa.github.io\/en\/posts\/"},{"@type":"ListItem","position":3,"name":"Kalman Smoother (RTS Smoother): Theory and Python Implementation"}]}</script><link rel=preconnect href=https://fonts.googleapis.com><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel=stylesheet><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css integrity="sha512-iecdLmaskl7CVkqkXNQ/ZH/XLlvWZOJyj7Yy7tcenmpD1ypASozpmT/E0iPtmFIB46ZmdtAc9eNBvH0H/ZpiBw==" crossorigin=anonymous referrerpolicy=no-referrer><link href=https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css rel=stylesheet integrity=sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH crossorigin=anonymous><link rel=stylesheet href=/css/variables.min.72a177faa7b12de55dcc39c4ab6b6392116718d5e2735dab0214511354ecb973.css integrity="sha256-cqF3+qexLeVdzDnEq2tjkhFnGNXic12rAhRRE1TsuXM=" crossorigin=anonymous><link rel=stylesheet href=/css/main.min.403a82b29e94ee6e7a39204b5082cdf8b4966cfb44115390da7d8867a5006acd.css integrity="sha256-QDqCsp6U7m56OSBLUILN+LSWbPtEEVOQ2n2IZ6UAas0=" crossorigin=anonymous><link rel=stylesheet href=/css/syntax.min.e379066489e20d5433ca35ac1f468fd9e8859705a62d77a79bb7379ac3613848.css integrity="sha256-43kGZIniDVQzyjWsH0aP2eiFlwWmLXenm7c3msNhOEg=" crossorigin=anonymous><style>body{font-family:-apple-system,BlinkMacSystemFont,inter,segoe ui,Roboto,sans-serif;line-height:1.5;color:#000;background:#fff}[data-theme=dark] body{color:#fff;background:#000}.container{max-width:768px;margin:0 auto;padding:0 1rem}</style><script src=https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js integrity=sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz crossorigin=anonymous defer></script><script src=/js/dark-mode.min.3e457dc8346f064bee795e6f9b73e1516dcd059e750c521fe4b445f9ea9a7821.js integrity="sha256-PkV9yDRvBkvueV5vm3PhUW3NBZ51DFIf5LRF+eqaeCE=" defer></script><script>window.addEventListener("load",function(){const e=document.createElement("script");e.async=!0,e.src="https://www.googletagmanager.com/gtag/js?id=G-LN6QP6VVM3",document.head.appendChild(e),e.onload=function(){window.dataLayer=window.dataLayer||[];function e(){dataLayer.push(arguments)}e("js",new Date),e("config","G-LN6QP6VVM3")}})</script><script>window.MathJax={tex:{inlineMath:[["\\(","\\)"]],displayMath:[["\\[","\\]"]],processEscapes:!0,processEnvironments:!0},options:{skipHtmlTags:["script","noscript","style","textarea","pre","code"],ignoreHtmlClass:"tex2jax_ignore",processHtmlClass:"tex2jax_process"}}</script><script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js id=mathjax-script async></script></head><body itemscope itemtype=https://schema.org/WebPage class=theme-tomatohugo><a href=#main-content class="skip-link sr-only sr-only-focusable" aria-label="Skip to main content">Skip to main content</a><header role=banner class=site-header><nav class="navbar navbar-expand-lg navbar-light bg-light" role=navigation aria-label="Main navigation"><div class=container><a class=navbar-brand href=https://yuhi-sa.github.io/ aria-label="Return to tomato blog homepage">tomato blog
</a><button class="navbar-toggler d-lg-none" type=button data-bs-toggle=collapse data-bs-target=#navbarNav aria-controls=navbarNav aria-expanded=false aria-label="Toggle navigation menu">
<span class=navbar-toggler-icon></span></button><div class="collapse navbar-collapse" id=navbarNav><ul class="navbar-nav ms-auto" role=menubar><li class=nav-item role=none><a class=nav-link href=https://yuhi-sa.github.io/en/ role=menuitem aria-label="Navigate to Blog">Blog</a></li><li class=nav-item role=none><a class=nav-link href=https://yuhi-sa.github.io/en/tags/ role=menuitem aria-label="Navigate to Tags">Tags</a></li><li class=nav-item role=none><a class=nav-link href=https://yuhi-sa.github.io/en/posts/about/ role=menuitem aria-label="Navigate to About">About</a></li><li class=nav-item role=none><a class=nav-link href=https://yuhi-sa.github.io/en/posts/privacy_policy/ role=menuitem aria-label="Navigate to Privacy policy">Privacy policy</a></li><li class=nav-item role=none><button id=darkModeToggle class="nav-link btn btn-link border-0" type=button role=menuitem aria-label="Toggle dark mode" title="Switch between light and dark themes">
<i class="fas fa-moon" id=darkModeIcon aria-hidden=true></i>
<span class="d-lg-none ms-2">ダークモード</span></button></li></ul></div></div></nav><script data-ad-client=ca-pub-9558545098866170 async crossorigin=anonymous src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></header><main id=main-content role=main class=site-main aria-label="Main content"><div class="container mt-4"><div class="row justify-content-center"><div class=col-lg-8><article itemscope itemtype=https://schema.org/Article><header class=article-header><h1 itemprop=headline>Kalman Smoother (RTS Smoother): Theory and Python Implementation</h1><p class="lead article-description" itemprop=description>A Python implementation of the Rauch-Tung-Striebel (RTS) smoother with mathematical derivation and accuracy comparison against the Kalman filter.</p><div class=article-meta><time datetime=2026-02-23T15:00:00+09:00 itemprop=datePublished><i class="far fa-calendar-alt me-1" aria-hidden=true></i>
February 23, 2026
</time><time datetime=2026-02-23T20:44:30+09:00 itemprop=dateModified class=ms-3><i class="far fa-edit me-1" aria-hidden=true></i>
Updated
February 23, 2026
</time><span aria-label="Reading time" class=ms-3><i class="far fa-clock me-1" aria-hidden=true></i>
7 min read</span></div><div class=article-tags role=group aria-label="Article tags"><a href=/en/tags/machine-learning/ class="badge badge-custom text-decoration-none me-1" rel=tag itemprop=keywords>Machine Learning
</a><a href=/en/tags/filtering/ class="badge badge-custom text-decoration-none me-1" rel=tag itemprop=keywords>Filtering
</a><a href=/en/tags/signal-processing/ class="badge badge-custom text-decoration-none me-1" rel=tag itemprop=keywords>Signal Processing
</a><a href=/en/tags/python/ class="badge badge-custom text-decoration-none me-1" rel=tag itemprop=keywords>Python</a></div></header><div class=article-content itemprop=articleBody><h2 id=introduction-filter-vs-smoother>Introduction: Filter vs Smoother</h2><p>Consider the problem of estimating a hidden state from time-series data. A Kalman filter processes data sequentially, estimating the state at each time step using only observations up to that point. A smoother, on the other hand, estimates the state at each time step using all available observations.</p><ul><li><strong>Filtering</strong>: estimation using observations up to time \(t\) → \(p(x_t | y_{1:t})\)</li><li><strong>Smoothing</strong>: estimation using all observations → \(p(x_t | y_{1:T})\)</li></ul><p>Because a smoother exploits future observations as well, it always achieves estimation accuracy equal to or better than a filter. However, since it requires the entire dataset before processing, it cannot be applied in real time. Smoothing is particularly useful in batch processing and post-hoc analysis, such as trajectory re-estimation and preprocessing for parameter estimation.</p><p>This article derives the theory of the <strong>Rauch-Tung-Striebel (RTS) smoother</strong>, the most widely used fixed-interval smoother, and implements it in Python.</p><p>Related articles: <a href=https://yuhi-sa.github.io/en/posts/20220206_ema/1/>Exponential Moving Average (EMA) Filter</a>, <a href=https://yuhi-sa.github.io/en/posts/20260215_ckf/1/>Cubature Kalman Filter (CKF): Theory and Python Implementation</a>, <a href=https://yuhi-sa.github.io/en/posts/20200901_filter/1/>Fundamentals of Filtering Methods in Signal Processing</a></p><h2 id=kalman-filter-review>Kalman Filter Review</h2><p>The RTS smoother takes the output of the Kalman filter forward pass as its input. We first define the linear Gaussian state-space model and briefly review the Kalman filter equations.</p><h3 id=state-space-model>State-Space Model</h3>\[
x_k = F x_{k-1} + w_{k-1}, \quad w_{k-1} \sim \mathcal{N}(0, Q) \tag{1}
\]\[
y_k = H x_k + v_k, \quad v_k \sim \mathcal{N}(0, R) \tag{2}
\]<p>where \(F\) is the state transition matrix, \(H\) is the observation matrix, \(Q\) is the process noise covariance, and \(R\) is the observation noise covariance.</p><h3 id=prediction-step>Prediction Step</h3>\[
\hat{x}_{k|k-1} = F \hat{x}_{k-1|k-1} \tag{3}
\]\[
P_{k|k-1} = F P_{k-1|k-1} F^T + Q \tag{4}
\]<h3 id=update-step>Update Step</h3>\[
K_k = P_{k|k-1} H^T (H P_{k|k-1} H^T + R)^{-1} \tag{5}
\]\[
\hat{x}_{k|k} = \hat{x}_{k|k-1} + K_k (y_k - H \hat{x}_{k|k-1}) \tag{6}
\]\[
P_{k|k} = (I - K_k H) P_{k|k-1} \tag{7}
\]<p>To run the RTS smoother, all intermediate quantities \(\hat{x}_{k|k}\), \(P_{k|k}\), \(\hat{x}_{k|k-1}\), and \(P_{k|k-1}\) from the forward pass must be stored.</p><h2 id=rts-smoother-derivation>RTS Smoother Derivation</h2><p>The RTS smoother uses the results of the Kalman filter forward pass to perform backward recursion from time \(T\) to \(0\).</p><h3 id=smoother-gain>Smoother Gain</h3><p>The smoother gain \(G_k\) determines the correction applied to the filter estimate \(\hat{x}_{k|k}\) to obtain the smoothed estimate \(\hat{x}_{k|T}\):</p>\[
G_k = P_{k|k} F^T P_{k+1|k}^{-1} \tag{8}
\]<p>This matrix is derived from the relationship between the filter covariance \(P_{k|k}\) at time \(k\) and the predicted covariance \(P_{k+1|k}\) at time \(k+1\).</p><h3 id=smoothed-state-estimate>Smoothed State Estimate</h3><p>The smoothed state estimate is obtained by adding a correction term to the filter estimate. This correction is the difference between the future smoothed estimate and the prediction, weighted by the smoother gain:</p>\[
\hat{x}_{k|T} = \hat{x}_{k|k} + G_k (\hat{x}_{k+1|T} - \hat{x}_{k+1|k}) \tag{9}
\]<p>Intuitively, this propagates information about how much the future observations corrected the filter prediction \(\hat{x}_{k+1|k}\) back to time \(k\).</p><h3 id=smoothed-covariance>Smoothed Covariance</h3><p>The smoothed covariance is computed as:</p>\[
P_{k|T} = P_{k|k} + G_k (P_{k+1|T} - P_{k+1|k}) G_k^T \tag{10}
\]<p>Since \(P_{k+1|T} - P_{k+1|k} \leq 0\) (smoothing reduces the covariance below the predicted covariance), we always have \(P_{k|T} \leq P_{k|k}\). In other words, the smoother estimate has lower uncertainty than the filter estimate.</p><h3 id=backward-pass-algorithm>Backward Pass Algorithm</h3><p>The initial conditions are \(\hat{x}_{T|T}\) and \(P_{T|T}\) (the final results of the forward pass). Equations \((8)\)&ndash;\((10)\) are then applied in reverse order for \(k = T-1, T-2, \ldots, 0\).</p><h2 id=python-implementation>Python Implementation</h2><p>We implement the Kalman filter and RTS smoother using a 1D position-velocity tracking problem as an example.</p><h3 id=state-space-model-definition>State-Space Model Definition</h3><p>We use a constant-velocity model with state vector \(x = [\text{position}, \text{velocity}]^T\).</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>numpy</span> <span class=k>as</span> <span class=nn>np</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>matplotlib.pyplot</span> <span class=k>as</span> <span class=nn>plt</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># ---- State-space model definition ----</span>
</span></span><span class=line><span class=cl><span class=n>dt</span> <span class=o>=</span> <span class=mf>1.0</span>  <span class=c1># sampling interval</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># State transition matrix (constant velocity model)</span>
</span></span><span class=line><span class=cl><span class=n>F</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>array</span><span class=p>([[</span><span class=mi>1</span><span class=p>,</span> <span class=n>dt</span><span class=p>],</span>
</span></span><span class=line><span class=cl>              <span class=p>[</span><span class=mi>0</span><span class=p>,</span> <span class=mi>1</span><span class=p>]])</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Observation matrix (position only)</span>
</span></span><span class=line><span class=cl><span class=n>H</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>array</span><span class=p>([[</span><span class=mi>1</span><span class=p>,</span> <span class=mi>0</span><span class=p>]])</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Process noise covariance</span>
</span></span><span class=line><span class=cl><span class=n>q</span> <span class=o>=</span> <span class=mf>0.1</span>
</span></span><span class=line><span class=cl><span class=n>Q</span> <span class=o>=</span> <span class=n>q</span> <span class=o>*</span> <span class=n>np</span><span class=o>.</span><span class=n>array</span><span class=p>([[</span><span class=n>dt</span><span class=o>**</span><span class=mi>3</span><span class=o>/</span><span class=mi>3</span><span class=p>,</span> <span class=n>dt</span><span class=o>**</span><span class=mi>2</span><span class=o>/</span><span class=mi>2</span><span class=p>],</span>
</span></span><span class=line><span class=cl>                   <span class=p>[</span><span class=n>dt</span><span class=o>**</span><span class=mi>2</span><span class=o>/</span><span class=mi>2</span><span class=p>,</span> <span class=n>dt</span><span class=p>]])</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Observation noise covariance</span>
</span></span><span class=line><span class=cl><span class=n>R</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>array</span><span class=p>([[</span><span class=mf>1.0</span><span class=p>]])</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>n</span> <span class=o>=</span> <span class=mi>2</span>  <span class=c1># state dimension</span>
</span></span><span class=line><span class=cl><span class=n>m</span> <span class=o>=</span> <span class=mi>1</span>  <span class=c1># observation dimension</span>
</span></span></code></pre></div><h3 id=kalman-filter-forward-pass>Kalman Filter (Forward Pass)</h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>def</span> <span class=nf>kalman_filter</span><span class=p>(</span><span class=n>y_obs</span><span class=p>,</span> <span class=n>F</span><span class=p>,</span> <span class=n>H</span><span class=p>,</span> <span class=n>Q</span><span class=p>,</span> <span class=n>R</span><span class=p>,</span> <span class=n>x0</span><span class=p>,</span> <span class=n>P0</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;Kalman filter forward pass (stores all intermediate results)&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>T</span> <span class=o>=</span> <span class=nb>len</span><span class=p>(</span><span class=n>y_obs</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>n</span> <span class=o>=</span> <span class=nb>len</span><span class=p>(</span><span class=n>x0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># Filtered estimates</span>
</span></span><span class=line><span class=cl>    <span class=n>x_filt</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>zeros</span><span class=p>((</span><span class=n>T</span> <span class=o>+</span> <span class=mi>1</span><span class=p>,</span> <span class=n>n</span><span class=p>))</span>  <span class=c1># x_{k|k}</span>
</span></span><span class=line><span class=cl>    <span class=n>P_filt</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>zeros</span><span class=p>((</span><span class=n>T</span> <span class=o>+</span> <span class=mi>1</span><span class=p>,</span> <span class=n>n</span><span class=p>,</span> <span class=n>n</span><span class=p>))</span>  <span class=c1># P_{k|k}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># Predicted values (used by smoother)</span>
</span></span><span class=line><span class=cl>    <span class=n>x_pred</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>zeros</span><span class=p>((</span><span class=n>T</span><span class=p>,</span> <span class=n>n</span><span class=p>))</span>  <span class=c1># x_{k|k-1}</span>
</span></span><span class=line><span class=cl>    <span class=n>P_pred</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>zeros</span><span class=p>((</span><span class=n>T</span><span class=p>,</span> <span class=n>n</span><span class=p>,</span> <span class=n>n</span><span class=p>))</span>  <span class=c1># P_{k|k-1}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># Initialization</span>
</span></span><span class=line><span class=cl>    <span class=n>x_filt</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span> <span class=o>=</span> <span class=n>x0</span>
</span></span><span class=line><span class=cl>    <span class=n>P_filt</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span> <span class=o>=</span> <span class=n>P0</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>k</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>T</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=c1># Prediction step (Eq. 3, 4)</span>
</span></span><span class=line><span class=cl>        <span class=n>x_pred</span><span class=p>[</span><span class=n>k</span><span class=p>]</span> <span class=o>=</span> <span class=n>F</span> <span class=o>@</span> <span class=n>x_filt</span><span class=p>[</span><span class=n>k</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=n>P_pred</span><span class=p>[</span><span class=n>k</span><span class=p>]</span> <span class=o>=</span> <span class=n>F</span> <span class=o>@</span> <span class=n>P_filt</span><span class=p>[</span><span class=n>k</span><span class=p>]</span> <span class=o>@</span> <span class=n>F</span><span class=o>.</span><span class=n>T</span> <span class=o>+</span> <span class=n>Q</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1># Update step (Eq. 5, 6, 7)</span>
</span></span><span class=line><span class=cl>        <span class=n>S</span> <span class=o>=</span> <span class=n>H</span> <span class=o>@</span> <span class=n>P_pred</span><span class=p>[</span><span class=n>k</span><span class=p>]</span> <span class=o>@</span> <span class=n>H</span><span class=o>.</span><span class=n>T</span> <span class=o>+</span> <span class=n>R</span>
</span></span><span class=line><span class=cl>        <span class=n>K</span> <span class=o>=</span> <span class=n>P_pred</span><span class=p>[</span><span class=n>k</span><span class=p>]</span> <span class=o>@</span> <span class=n>H</span><span class=o>.</span><span class=n>T</span> <span class=o>@</span> <span class=n>np</span><span class=o>.</span><span class=n>linalg</span><span class=o>.</span><span class=n>inv</span><span class=p>(</span><span class=n>S</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>innovation</span> <span class=o>=</span> <span class=n>y_obs</span><span class=p>[</span><span class=n>k</span><span class=p>]</span> <span class=o>-</span> <span class=n>H</span> <span class=o>@</span> <span class=n>x_pred</span><span class=p>[</span><span class=n>k</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=n>x_filt</span><span class=p>[</span><span class=n>k</span> <span class=o>+</span> <span class=mi>1</span><span class=p>]</span> <span class=o>=</span> <span class=n>x_pred</span><span class=p>[</span><span class=n>k</span><span class=p>]</span> <span class=o>+</span> <span class=n>K</span> <span class=o>@</span> <span class=n>innovation</span>
</span></span><span class=line><span class=cl>        <span class=n>P_filt</span><span class=p>[</span><span class=n>k</span> <span class=o>+</span> <span class=mi>1</span><span class=p>]</span> <span class=o>=</span> <span class=p>(</span><span class=n>np</span><span class=o>.</span><span class=n>eye</span><span class=p>(</span><span class=n>n</span><span class=p>)</span> <span class=o>-</span> <span class=n>K</span> <span class=o>@</span> <span class=n>H</span><span class=p>)</span> <span class=o>@</span> <span class=n>P_pred</span><span class=p>[</span><span class=n>k</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>x_filt</span><span class=p>,</span> <span class=n>P_filt</span><span class=p>,</span> <span class=n>x_pred</span><span class=p>,</span> <span class=n>P_pred</span>
</span></span></code></pre></div><h3 id=rts-smoother-backward-pass>RTS Smoother (Backward Pass)</h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>def</span> <span class=nf>rts_smoother</span><span class=p>(</span><span class=n>x_filt</span><span class=p>,</span> <span class=n>P_filt</span><span class=p>,</span> <span class=n>x_pred</span><span class=p>,</span> <span class=n>P_pred</span><span class=p>,</span> <span class=n>F</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;RTS smoother backward pass&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>T</span> <span class=o>=</span> <span class=nb>len</span><span class=p>(</span><span class=n>x_pred</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>n</span> <span class=o>=</span> <span class=n>x_filt</span><span class=o>.</span><span class=n>shape</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># Smoothed estimates</span>
</span></span><span class=line><span class=cl>    <span class=n>x_smooth</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>zeros</span><span class=p>((</span><span class=n>T</span> <span class=o>+</span> <span class=mi>1</span><span class=p>,</span> <span class=n>n</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=n>P_smooth</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>zeros</span><span class=p>((</span><span class=n>T</span> <span class=o>+</span> <span class=mi>1</span><span class=p>,</span> <span class=n>n</span><span class=p>,</span> <span class=n>n</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># Initial condition: final filter estimate</span>
</span></span><span class=line><span class=cl>    <span class=n>x_smooth</span><span class=p>[</span><span class=n>T</span><span class=p>]</span> <span class=o>=</span> <span class=n>x_filt</span><span class=p>[</span><span class=n>T</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=n>P_smooth</span><span class=p>[</span><span class=n>T</span><span class=p>]</span> <span class=o>=</span> <span class=n>P_filt</span><span class=p>[</span><span class=n>T</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># Backward recursion</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>k</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>T</span> <span class=o>-</span> <span class=mi>1</span><span class=p>,</span> <span class=o>-</span><span class=mi>1</span><span class=p>,</span> <span class=o>-</span><span class=mi>1</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=c1># Smoother gain (Eq. 8)</span>
</span></span><span class=line><span class=cl>        <span class=n>G</span> <span class=o>=</span> <span class=n>P_filt</span><span class=p>[</span><span class=n>k</span><span class=p>]</span> <span class=o>@</span> <span class=n>F</span><span class=o>.</span><span class=n>T</span> <span class=o>@</span> <span class=n>np</span><span class=o>.</span><span class=n>linalg</span><span class=o>.</span><span class=n>inv</span><span class=p>(</span><span class=n>P_pred</span><span class=p>[</span><span class=n>k</span><span class=p>])</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1># Smoothed state estimate (Eq. 9)</span>
</span></span><span class=line><span class=cl>        <span class=n>x_smooth</span><span class=p>[</span><span class=n>k</span><span class=p>]</span> <span class=o>=</span> <span class=n>x_filt</span><span class=p>[</span><span class=n>k</span><span class=p>]</span> <span class=o>+</span> <span class=n>G</span> <span class=o>@</span> <span class=p>(</span><span class=n>x_smooth</span><span class=p>[</span><span class=n>k</span> <span class=o>+</span> <span class=mi>1</span><span class=p>]</span> <span class=o>-</span> <span class=n>x_pred</span><span class=p>[</span><span class=n>k</span><span class=p>])</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1># Smoothed covariance (Eq. 10)</span>
</span></span><span class=line><span class=cl>        <span class=n>P_smooth</span><span class=p>[</span><span class=n>k</span><span class=p>]</span> <span class=o>=</span> <span class=n>P_filt</span><span class=p>[</span><span class=n>k</span><span class=p>]</span> <span class=o>+</span> <span class=n>G</span> <span class=o>@</span> <span class=p>(</span><span class=n>P_smooth</span><span class=p>[</span><span class=n>k</span> <span class=o>+</span> <span class=mi>1</span><span class=p>]</span> <span class=o>-</span> <span class=n>P_pred</span><span class=p>[</span><span class=n>k</span><span class=p>])</span> <span class=o>@</span> <span class=n>G</span><span class=o>.</span><span class=n>T</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>x_smooth</span><span class=p>,</span> <span class=n>P_smooth</span>
</span></span></code></pre></div><h3 id=simulation>Simulation</h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>np</span><span class=o>.</span><span class=n>random</span><span class=o>.</span><span class=n>seed</span><span class=p>(</span><span class=mi>42</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>T</span> <span class=o>=</span> <span class=mi>50</span>  <span class=c1># number of time steps</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># True initial state</span>
</span></span><span class=line><span class=cl><span class=n>x_true_init</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>array</span><span class=p>([</span><span class=mf>0.0</span><span class=p>,</span> <span class=mf>1.0</span><span class=p>])</span>  <span class=c1># position 0, velocity 1</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Generate true states</span>
</span></span><span class=line><span class=cl><span class=n>true_states</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>zeros</span><span class=p>((</span><span class=n>T</span> <span class=o>+</span> <span class=mi>1</span><span class=p>,</span> <span class=n>n</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=n>true_states</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span> <span class=o>=</span> <span class=n>x_true_init</span>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>k</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>T</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>true_states</span><span class=p>[</span><span class=n>k</span> <span class=o>+</span> <span class=mi>1</span><span class=p>]</span> <span class=o>=</span> <span class=n>F</span> <span class=o>@</span> <span class=n>true_states</span><span class=p>[</span><span class=n>k</span><span class=p>]</span> <span class=o>+</span> \
</span></span><span class=line><span class=cl>        <span class=n>np</span><span class=o>.</span><span class=n>random</span><span class=o>.</span><span class=n>multivariate_normal</span><span class=p>(</span><span class=n>np</span><span class=o>.</span><span class=n>zeros</span><span class=p>(</span><span class=n>n</span><span class=p>),</span> <span class=n>Q</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Generate observations</span>
</span></span><span class=line><span class=cl><span class=n>y_obs</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>zeros</span><span class=p>((</span><span class=n>T</span><span class=p>,</span> <span class=n>m</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>k</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>T</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>y_obs</span><span class=p>[</span><span class=n>k</span><span class=p>]</span> <span class=o>=</span> <span class=n>H</span> <span class=o>@</span> <span class=n>true_states</span><span class=p>[</span><span class=n>k</span> <span class=o>+</span> <span class=mi>1</span><span class=p>]</span> <span class=o>+</span> \
</span></span><span class=line><span class=cl>        <span class=n>np</span><span class=o>.</span><span class=n>random</span><span class=o>.</span><span class=n>multivariate_normal</span><span class=p>(</span><span class=n>np</span><span class=o>.</span><span class=n>zeros</span><span class=p>(</span><span class=n>m</span><span class=p>),</span> <span class=n>R</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Filter initial estimate</span>
</span></span><span class=line><span class=cl><span class=n>x0</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>array</span><span class=p>([</span><span class=mf>0.0</span><span class=p>,</span> <span class=mf>0.0</span><span class=p>])</span>
</span></span><span class=line><span class=cl><span class=n>P0</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>diag</span><span class=p>([</span><span class=mf>1.0</span><span class=p>,</span> <span class=mf>1.0</span><span class=p>])</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Run Kalman filter</span>
</span></span><span class=line><span class=cl><span class=n>x_filt</span><span class=p>,</span> <span class=n>P_filt</span><span class=p>,</span> <span class=n>x_pred</span><span class=p>,</span> <span class=n>P_pred</span> <span class=o>=</span> <span class=n>kalman_filter</span><span class=p>(</span><span class=n>y_obs</span><span class=p>,</span> <span class=n>F</span><span class=p>,</span> <span class=n>H</span><span class=p>,</span> <span class=n>Q</span><span class=p>,</span> <span class=n>R</span><span class=p>,</span> <span class=n>x0</span><span class=p>,</span> <span class=n>P0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Run RTS smoother</span>
</span></span><span class=line><span class=cl><span class=n>x_smooth</span><span class=p>,</span> <span class=n>P_smooth</span> <span class=o>=</span> <span class=n>rts_smoother</span><span class=p>(</span><span class=n>x_filt</span><span class=p>,</span> <span class=n>P_filt</span><span class=p>,</span> <span class=n>x_pred</span><span class=p>,</span> <span class=n>P_pred</span><span class=p>,</span> <span class=n>F</span><span class=p>)</span>
</span></span></code></pre></div><h3 id=filter-vs-smoother-comparison>Filter vs Smoother Comparison</h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>time</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>arange</span><span class=p>(</span><span class=n>T</span> <span class=o>+</span> <span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># ---- Position estimation results ----</span>
</span></span><span class=line><span class=cl><span class=n>plt</span><span class=o>.</span><span class=n>figure</span><span class=p>(</span><span class=n>figsize</span><span class=o>=</span><span class=p>(</span><span class=mi>12</span><span class=p>,</span> <span class=mi>8</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>plt</span><span class=o>.</span><span class=n>subplot</span><span class=p>(</span><span class=mi>2</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>plt</span><span class=o>.</span><span class=n>plot</span><span class=p>(</span><span class=n>time</span><span class=p>,</span> <span class=n>true_states</span><span class=p>[:,</span> <span class=mi>0</span><span class=p>],</span> <span class=s2>&#34;b-&#34;</span><span class=p>,</span> <span class=n>linewidth</span><span class=o>=</span><span class=mi>2</span><span class=p>,</span> <span class=n>label</span><span class=o>=</span><span class=s2>&#34;True state&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>plt</span><span class=o>.</span><span class=n>scatter</span><span class=p>(</span><span class=n>np</span><span class=o>.</span><span class=n>arange</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=n>T</span> <span class=o>+</span> <span class=mi>1</span><span class=p>),</span> <span class=n>y_obs</span><span class=p>[:,</span> <span class=mi>0</span><span class=p>],</span>
</span></span><span class=line><span class=cl>            <span class=n>c</span><span class=o>=</span><span class=s2>&#34;gray&#34;</span><span class=p>,</span> <span class=n>s</span><span class=o>=</span><span class=mi>15</span><span class=p>,</span> <span class=n>alpha</span><span class=o>=</span><span class=mf>0.5</span><span class=p>,</span> <span class=n>label</span><span class=o>=</span><span class=s2>&#34;Measurements&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>plt</span><span class=o>.</span><span class=n>plot</span><span class=p>(</span><span class=n>time</span><span class=p>,</span> <span class=n>x_filt</span><span class=p>[:,</span> <span class=mi>0</span><span class=p>],</span> <span class=s2>&#34;r--&#34;</span><span class=p>,</span> <span class=n>linewidth</span><span class=o>=</span><span class=mf>1.5</span><span class=p>,</span> <span class=n>label</span><span class=o>=</span><span class=s2>&#34;KF estimate&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>plt</span><span class=o>.</span><span class=n>plot</span><span class=p>(</span><span class=n>time</span><span class=p>,</span> <span class=n>x_smooth</span><span class=p>[:,</span> <span class=mi>0</span><span class=p>],</span> <span class=s2>&#34;g-&#34;</span><span class=p>,</span> <span class=n>linewidth</span><span class=o>=</span><span class=mf>1.5</span><span class=p>,</span> <span class=n>label</span><span class=o>=</span><span class=s2>&#34;RTS estimate&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>plt</span><span class=o>.</span><span class=n>xlabel</span><span class=p>(</span><span class=s2>&#34;Time step&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>plt</span><span class=o>.</span><span class=n>ylabel</span><span class=p>(</span><span class=s2>&#34;Position&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>plt</span><span class=o>.</span><span class=n>title</span><span class=p>(</span><span class=s2>&#34;Position Estimation: Kalman Filter vs RTS Smoother&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>plt</span><span class=o>.</span><span class=n>legend</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>plt</span><span class=o>.</span><span class=n>grid</span><span class=p>(</span><span class=kc>True</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># ---- Position estimation error covariance ----</span>
</span></span><span class=line><span class=cl><span class=n>plt</span><span class=o>.</span><span class=n>subplot</span><span class=p>(</span><span class=mi>2</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=mi>2</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>kf_pos_var</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>array</span><span class=p>([</span><span class=n>P_filt</span><span class=p>[</span><span class=n>k</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>0</span><span class=p>]</span> <span class=k>for</span> <span class=n>k</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>T</span> <span class=o>+</span> <span class=mi>1</span><span class=p>)])</span>
</span></span><span class=line><span class=cl><span class=n>rts_pos_var</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>array</span><span class=p>([</span><span class=n>P_smooth</span><span class=p>[</span><span class=n>k</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>0</span><span class=p>]</span> <span class=k>for</span> <span class=n>k</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>T</span> <span class=o>+</span> <span class=mi>1</span><span class=p>)])</span>
</span></span><span class=line><span class=cl><span class=n>plt</span><span class=o>.</span><span class=n>plot</span><span class=p>(</span><span class=n>time</span><span class=p>,</span> <span class=n>kf_pos_var</span><span class=p>,</span> <span class=s2>&#34;r--&#34;</span><span class=p>,</span> <span class=n>linewidth</span><span class=o>=</span><span class=mf>1.5</span><span class=p>,</span> <span class=n>label</span><span class=o>=</span><span class=s2>&#34;KF variance&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>plt</span><span class=o>.</span><span class=n>plot</span><span class=p>(</span><span class=n>time</span><span class=p>,</span> <span class=n>rts_pos_var</span><span class=p>,</span> <span class=s2>&#34;g-&#34;</span><span class=p>,</span> <span class=n>linewidth</span><span class=o>=</span><span class=mf>1.5</span><span class=p>,</span> <span class=n>label</span><span class=o>=</span><span class=s2>&#34;RTS variance&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>plt</span><span class=o>.</span><span class=n>xlabel</span><span class=p>(</span><span class=s2>&#34;Time step&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>plt</span><span class=o>.</span><span class=n>ylabel</span><span class=p>(</span><span class=s2>&#34;Position variance&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>plt</span><span class=o>.</span><span class=n>title</span><span class=p>(</span><span class=s2>&#34;Estimation Error Covariance Comparison&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>plt</span><span class=o>.</span><span class=n>legend</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>plt</span><span class=o>.</span><span class=n>grid</span><span class=p>(</span><span class=kc>True</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>plt</span><span class=o>.</span><span class=n>tight_layout</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>plt</span><span class=o>.</span><span class=n>savefig</span><span class=p>(</span><span class=s2>&#34;rts_smoother_result.png&#34;</span><span class=p>,</span> <span class=n>dpi</span><span class=o>=</span><span class=mi>150</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>plt</span><span class=o>.</span><span class=n>show</span><span class=p>()</span>
</span></span></code></pre></div><p><img src=/posts/20260223_rts_smoother/rts_smoother_result.png alt="RTS Smoother results"></p><p>The velocity estimation (an unobserved state component) is shown below. The smoother achieves even more dramatic improvement for unobserved states.</p><p><img src=/posts/20260223_rts_smoother/rts_velocity_comparison.png alt="Velocity estimation comparison"></p><h3 id=rmse-comparison>RMSE Comparison</h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># Position RMSE</span>
</span></span><span class=line><span class=cl><span class=n>rmse_kf</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>sqrt</span><span class=p>(</span><span class=n>np</span><span class=o>.</span><span class=n>mean</span><span class=p>((</span><span class=n>true_states</span><span class=p>[</span><span class=mi>1</span><span class=p>:,</span> <span class=mi>0</span><span class=p>]</span> <span class=o>-</span> <span class=n>x_filt</span><span class=p>[</span><span class=mi>1</span><span class=p>:,</span> <span class=mi>0</span><span class=p>])</span><span class=o>**</span><span class=mi>2</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=n>rmse_rts</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>sqrt</span><span class=p>(</span><span class=n>np</span><span class=o>.</span><span class=n>mean</span><span class=p>((</span><span class=n>true_states</span><span class=p>[</span><span class=mi>1</span><span class=p>:,</span> <span class=mi>0</span><span class=p>]</span> <span class=o>-</span> <span class=n>x_smooth</span><span class=p>[</span><span class=mi>1</span><span class=p>:,</span> <span class=mi>0</span><span class=p>])</span><span class=o>**</span><span class=mi>2</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Velocity RMSE</span>
</span></span><span class=line><span class=cl><span class=n>rmse_kf_vel</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>sqrt</span><span class=p>(</span><span class=n>np</span><span class=o>.</span><span class=n>mean</span><span class=p>((</span><span class=n>true_states</span><span class=p>[</span><span class=mi>1</span><span class=p>:,</span> <span class=mi>1</span><span class=p>]</span> <span class=o>-</span> <span class=n>x_filt</span><span class=p>[</span><span class=mi>1</span><span class=p>:,</span> <span class=mi>1</span><span class=p>])</span><span class=o>**</span><span class=mi>2</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=n>rmse_rts_vel</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>sqrt</span><span class=p>(</span><span class=n>np</span><span class=o>.</span><span class=n>mean</span><span class=p>((</span><span class=n>true_states</span><span class=p>[</span><span class=mi>1</span><span class=p>:,</span> <span class=mi>1</span><span class=p>]</span> <span class=o>-</span> <span class=n>x_smooth</span><span class=p>[</span><span class=mi>1</span><span class=p>:,</span> <span class=mi>1</span><span class=p>])</span><span class=o>**</span><span class=mi>2</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Position RMSE - KF: </span><span class=si>{</span><span class=n>rmse_kf</span><span class=si>:</span><span class=s2>.4f</span><span class=si>}</span><span class=s2>, RTS: </span><span class=si>{</span><span class=n>rmse_rts</span><span class=si>:</span><span class=s2>.4f</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Velocity RMSE - KF: </span><span class=si>{</span><span class=n>rmse_kf_vel</span><span class=si>:</span><span class=s2>.4f</span><span class=si>}</span><span class=s2>, RTS: </span><span class=si>{</span><span class=n>rmse_rts_vel</span><span class=si>:</span><span class=s2>.4f</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Position improvement: </span><span class=si>{</span><span class=p>(</span><span class=mi>1</span> <span class=o>-</span> <span class=n>rmse_rts</span> <span class=o>/</span> <span class=n>rmse_kf</span><span class=p>)</span> <span class=o>*</span> <span class=mi>100</span><span class=si>:</span><span class=s2>.1f</span><span class=si>}</span><span class=s2>%&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Velocity improvement: </span><span class=si>{</span><span class=p>(</span><span class=mi>1</span> <span class=o>-</span> <span class=n>rmse_rts_vel</span> <span class=o>/</span> <span class=n>rmse_kf_vel</span><span class=p>)</span> <span class=o>*</span> <span class=mi>100</span><span class=si>:</span><span class=s2>.1f</span><span class=si>}</span><span class=s2>%&#34;</span><span class=p>)</span>
</span></span></code></pre></div><table><thead><tr><th>Metric</th><th>Kalman Filter</th><th>RTS Smoother</th><th>Improvement</th></tr></thead><tbody><tr><td>Position RMSE</td><td>0.6540</td><td>0.3638</td><td>44.4%</td></tr><tr><td>Velocity RMSE</td><td>0.3884</td><td>0.2358</td><td>39.3%</td></tr></tbody></table><p>The RTS smoother estimate is consistently closer to the true state than the Kalman filter estimate, with significant accuracy improvements especially away from the data endpoints. The error covariance plot also confirms that the smoother uncertainty is always less than or equal to that of the filter.</p><h2 id=summary>Summary</h2><p>The RTS smoother achieves significant accuracy improvements over the Kalman filter by simply adding a backward pass to the forward pass, with minimal implementation overhead. For any batch-processing scenario where real-time estimation is not required, applying the RTS smoother should be the first consideration.</p><p>Note that this article focused on linear models. For nonlinear models, extensions such as the Extended Kalman Smoother, Unscented Kalman Smoother, and <a href=https://yuhi-sa.github.io/en/posts/20260215_ckf/1/>CKF</a>-based smoothers are available.</p><h2 id=references>References</h2><ul><li>Rauch, H. E., Tung, F., & Striebel, C. T. (1965). &ldquo;Maximum likelihood estimates of linear dynamic systems.&rdquo; <em>AIAA Journal</em>, 3(8), 1445-1450.</li><li>Särkkä, S. (2013). <em>Bayesian Filtering and Smoothing</em>. Cambridge University Press.</li></ul></div><div class="ad-slot in-content my-3"><ins class=adsbygoogle style=display:block;text-align:center data-ad-layout=in-article data-ad-format=fluid data-ad-client=ca-pub-9558545098866170></ins><script>(adsbygoogle=window.adsbygoogle||[]).push({})</script></div><footer class=article-footer></footer><meta itemprop=wordCount content="1410"><meta itemprop=url content="https://yuhi-sa.github.io/en/posts/20260223_rts_smoother/1/"></article><nav class="post-nav mt-5" aria-label="Post navigation"><a href=/en/posts/20260223_progress_bar/1/ class="post-nav__item post-nav__item--prev"><span class="post-nav__label text-muted"><i class="fas fa-arrow-left me-1" aria-hidden=true></i>前の記事
</span><span class=post-nav__title>Building a Progress Bar in Python from Scratch (Without tqdm)</span>
</a><a href=/en/posts/20260223_security_certs/1/ class="post-nav__item post-nav__item--next"><span class="post-nav__label text-muted">次の記事<i class="fas fa-arrow-right ms-1" aria-hidden=true></i>
</span><span class=post-nav__title>Security Certification Comparison: CISSP vs Japan's Registered Information Security Specialist</span></a></nav><section class="related-posts mt-5" aria-label="Related posts"><h2 class=related-posts__title>関連記事</h2><div class=related-posts__grid><article class=related-posts__item><h3 class=related-posts__item-title><a href=/en/posts/20260228_timeseries_anomaly/1/>Time-Series Anomaly Detection: From Statistical Methods to Kalman Filter in Python</a></h3><div class=card-meta><time datetime=2026-02-28>February 28, 2026</time></div></article><article class=related-posts__item><h3 class=related-posts__item-title><a href=/en/posts/20260228_notch_filter/1/>Notch Filter Design and Python Implementation: Removing Power Line Noise</a></h3><div class=card-meta><time datetime=2026-02-28>February 28, 2026</time></div></article><article class=related-posts__item><h3 class=related-posts__item-title><a href=/en/posts/20260226_wiener_filter/1/>Wiener Filter: Optimal Linear Filtering Theory and Python Implementation</a></h3><div class=card-meta><time datetime=2026-02-26>February 26, 2026</time></div></article></div></section><nav class="article-navigation mt-4" aria-label="Article navigation"><a href=/en/posts/ class="btn btn-outline-secondary btn-sm mb-3"><i class="fas fa-arrow-left me-1" aria-hidden=true></i>
Back to posts</a><nav aria-label="Breadcrumb navigation" class=breadcrumb-nav role=navigation><ol class=breadcrumb itemscope itemtype=https://schema.org/BreadcrumbList><li class=breadcrumb-item itemprop=itemListElement itemscope itemtype=https://schema.org/ListItem><a href=/en/ itemprop=item aria-label="Navigate to homepage"><i class="fas fa-home" aria-hidden=true></i>
<span itemprop=name>tomato blog</span>
</a><meta itemprop=position content="1"></li><li class=breadcrumb-item itemprop=itemListElement itemscope itemtype=https://schema.org/ListItem><a href=https://yuhi-sa.github.io/en/ itemprop=item aria-label="Navigate to tomato blog"><span itemprop=name>tomato blog</span>
</a><meta itemprop=position content="2"></li><li class=breadcrumb-item itemprop=itemListElement itemscope itemtype=https://schema.org/ListItem><a href=https://yuhi-sa.github.io/en/posts/ itemprop=item aria-label="Navigate to Posts"><span itemprop=name>Posts</span>
</a><meta itemprop=position content="3"></li><li class="breadcrumb-item active" aria-current=page itemprop=itemListElement itemscope itemtype=https://schema.org/ListItem><span itemprop=name>Kalman Smoother (RTS Smoother): Theory and Python Implementation</span>
<meta itemprop=position content="4"></li></ol></nav></nav></div></div></div></main><footer role=contentinfo class=site-footer><div class="container pt-4 pb-3" style="border-top:2px solid var(--accent,#e54d2e)"><div class="row justify-content-center"><div class="col-md-8 text-center"><p class="copyright-text text-muted mb-2">&copy; 2026 yuhi-sa. All rights reserved.</p><p class="theme-attribution text-muted small mt-2 mb-0">Powered by
<a href=https://gohugo.io/ target=_blank rel=noopener class=text-decoration-none>Hugo</a>
with
<a href=https://github.com/yuhi-sa/tomatohugo target=_blank rel=noopener class=text-decoration-none>TomatoHugo</a></p></div></div></div></footer><script src=https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js integrity=sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz crossorigin=anonymous defer></script><script src=/js/dark-mode.min.3e457dc8346f064bee795e6f9b73e1516dcd059e750c521fe4b445f9ea9a7821.js integrity="sha256-PkV9yDRvBkvueV5vm3PhUW3NBZ51DFIf5LRF+eqaeCE=" defer></script><script>window.addEventListener("load",function(){const e=document.createElement("script");e.async=!0,e.src="https://www.googletagmanager.com/gtag/js?id=G-LN6QP6VVM3",document.head.appendChild(e),e.onload=function(){window.dataLayer=window.dataLayer||[];function e(){dataLayer.push(arguments)}e("js",new Date),e("config","G-LN6QP6VVM3")}})</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"WebPage","name":"Kalman Smoother (RTS Smoother): Theory and Python Implementation","url":"https:\/\/yuhi-sa.github.io\/en\/posts\/20260223_rts_smoother\/1\/","description":"A Python implementation of the Rauch-Tung-Striebel (RTS) smoother with mathematical derivation and accuracy comparison against the Kalman filter.","inLanguage":"en","isPartOf":{"@type":"WebSite","name":"tomato blog","url":"https:\/\/yuhi-sa.github.io\/"}}</script></body></html>