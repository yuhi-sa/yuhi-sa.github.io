<!doctype html><html lang=ja dir=ltr><head><meta charset=utf-8><meta name=viewport content="width=device-width"><title>指数移動平均(Exponential Moving Averages)フィルタの周波数特性 | tomato blog</title>
<link href=https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css integrity=sha384-9ndCyUaIbzAi2FUVXJi0CjmCapSmO7SnpJef0486qhLnuZ2cdeRhO02iuK6FUUVM crossorigin=anonymous rel=stylesheet><link rel=stylesheet href=/css/main.min.cbcf0adf3096d54322591302ca01248346902aa2474afcbd71c3a1b999e09ad9.css integrity="sha256-y88K3zCW1UMiWRMCygEkg0aQKqJHSvy9ccOhuZngmtk=" crossorigin=anonymous><link rel=stylesheet href=/css/syntax.min.aa0332253f313dc48905008b4ab314155e5a13302588d25bcf4949f7c1abdde0.css integrity="sha256-qgMyJT8xPcSJBQCLSrMUFV5aEzAliNJbz0lJ98Gr3eA=" crossorigin=anonymous><link rel=stylesheet href=https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css><script src=https://code.jquery.com/jquery-3.2.1.slim.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js></script><script src=https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js></script><script id=MathJax-script async src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js></script><script>MathJax={tex:{inlineMath:[["$","$"],["\\(","\\)"]]}}</script></head><body><header><nav class="navbar navbar-expand-lg navbar-light bg-light"><div class=navbar-brand>tomato blog</div><button class="navbar-toggler ml-auto" type=button data-toggle=collapse data-target=#navbarNav aria-controls=navbarNav aria-expanded=false aria-label="Toggle navigation">
<span class=navbar-toggler-icon></span></button><div class="collapse navbar-collapse" id=navbarNav><ul class="navbar-nav ml-auto"><li class=nav-item><a zgotmplz href=https://yuhi-sa.github.io/ class=nav-link>Blog</a></li><li class=nav-item><a zgotmplz href=https://yuhi-sa.github.io/tags class=nav-link>Tags</a></li><li class=nav-item><a zgotmplz href=https://yuhi-sa.github.io/posts/about class=nav-link>About</a></li><li class=nav-item><a zgotmplz href=https://yuhi-sa.github.io/posts/privacy_policy class=nav-link>Privacy policy</a></li></ul></div></nav><script async src="https://www.googletagmanager.com/gtag/js?id=G-LN6QP6VVM3"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-LN6QP6VVM3")</script><script data-ad-client=ca-pub-9558545098866170 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></header><main><h1 id=指数移動平均exponential-moving-averagesフィルタの周波数特性>指数移動平均(Exponential Moving Averages)フィルタの周波数特性</h1><h2 id=指数移動平均exponential-moving-averagesema>指数移動平均(Exponential Moving Averages;EMA)</h2><p>入力$x$に対して，平滑化率$\beta$に応じて時系列平滑化を行い$y$を得ることによって時系列データを平滑化する代表的な手法である．
1ステップ前のフィルタリングされたの値と現在の観測値を$\beta$を用いて重み付けし足し合わせることで，
最近のデータを重視するとともに古いデータを完全には切り捨てない仕組みとなっている．</p><p>$$y_t=\beta y_{t-1}+(1-\beta)x_t$$</p><h2 id=ゲイン特性と位相特性>ゲイン特性と位相特性</h2><p>上式をラプラス変換する．</p><p>$$Y(s)=\beta e^{-s}Y(s)+(1-\beta)X(s)$$</p><p>式変形し伝達関数を求める．</p><p>$$G(s)=\frac{Y(s)}{X(s)}=\frac{\beta}{1+(1-\beta)e^{-s}}$$</p><p>$s=jw$とする．</p><p>$$G(jw)= \frac{\beta}{1+(1-\beta)e^{-jw}}$$</p><p>ゲイン特性と位相特性は以下の様になる．</p><p>$$|G(jw)| = \frac{\beta}{\sqrt{1-2(1-\beta)
\cos w+(1-\beta)^2}}$$</p><p><img alt=ゲイン特性 src=.././Gain.pdf></p><p>$$\angle G(jw) = \tan^{-1}
(\frac{-\sin w}{\cos w-(1-\beta)})$$</p><p><img alt=位相特性 src=.././Phase.pdf></p><p>$\beta$が小さい場合，周波数帯域が狭く強い平滑化を行うことができるが位相遅れが大きくなる．
一方で$\beta$が大きい場合，位相遅れは小さいが平滑化能力が低下することがわかる．</p><h2 id=プログラム>プログラム</h2><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>math</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>matplotlib.pyplot</span> <span class=k>as</span> <span class=nn>plt</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>BETA</span> <span class=o>=</span> <span class=p>[</span><span class=mf>0.1</span><span class=p>,</span> <span class=mf>0.2</span><span class=p>,</span> <span class=mf>0.3</span><span class=p>,</span> <span class=mf>0.4</span><span class=p>,</span> <span class=mf>0.5</span><span class=p>,</span> <span class=mf>0.6</span><span class=p>,</span> <span class=mf>0.7</span><span class=p>,</span> <span class=mf>0.8</span><span class=p>,</span> <span class=mf>0.9</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=n>LENGE</span> <span class=o>=</span> <span class=mi>300</span>
</span></span><span class=line><span class=cl><span class=n>frequency</span> <span class=o>=</span> <span class=p>[[]</span> <span class=k>for</span> <span class=n>_</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=nb>len</span><span class=p>(</span><span class=n>BETA</span><span class=p>))]</span>
</span></span><span class=line><span class=cl><span class=n>gain</span>  <span class=o>=</span> <span class=p>[[]</span> <span class=k>for</span> <span class=n>_</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=nb>len</span><span class=p>(</span><span class=n>BETA</span><span class=p>))]</span>
</span></span><span class=line><span class=cl><span class=n>phase</span> <span class=o>=</span> <span class=p>[[]</span> <span class=k>for</span> <span class=n>_</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=nb>len</span><span class=p>(</span><span class=n>BETA</span><span class=p>))]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>get_gain</span><span class=p>(</span><span class=n>beta</span><span class=p>,</span> <span class=n>w</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>beta</span> <span class=o>/</span> <span class=n>math</span><span class=o>.</span><span class=n>sqrt</span><span class=p>(</span><span class=mi>1</span><span class=o>-</span><span class=mi>2</span><span class=o>*</span><span class=p>(</span><span class=mi>1</span><span class=o>-</span><span class=n>beta</span><span class=p>)</span><span class=o>*</span><span class=n>math</span><span class=o>.</span><span class=n>cos</span><span class=p>(</span><span class=n>w</span><span class=p>)</span><span class=o>+</span><span class=p>(</span><span class=mi>1</span><span class=o>-</span><span class=n>beta</span><span class=p>)</span><span class=o>*</span><span class=p>(</span><span class=mi>1</span><span class=o>-</span><span class=n>beta</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>get_phase</span><span class=p>(</span><span class=n>beta</span><span class=p>,</span> <span class=n>w</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>math</span><span class=o>.</span><span class=n>atan</span><span class=p>(</span><span class=o>-</span><span class=n>math</span><span class=o>.</span><span class=n>sin</span><span class=p>(</span><span class=n>w</span><span class=p>)</span><span class=o>/</span><span class=p>(</span><span class=n>math</span><span class=o>.</span><span class=n>cos</span><span class=p>(</span><span class=n>w</span><span class=p>)</span><span class=o>-</span><span class=p>(</span><span class=mi>1</span><span class=o>-</span><span class=n>beta</span><span class=p>)))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>beta_index</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=nb>len</span><span class=p>(</span><span class=n>BETA</span><span class=p>)):</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>w</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>LENGE</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>frequency</span><span class=p>[</span><span class=n>beta_index</span><span class=p>]</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>w</span><span class=o>/</span><span class=mi>100</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>gain</span><span class=p>[</span><span class=n>beta_index</span><span class=p>]</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>get_gain</span><span class=p>(</span><span class=n>BETA</span><span class=p>[</span><span class=n>beta_index</span><span class=p>],</span> <span class=n>w</span><span class=o>/</span><span class=mi>100</span><span class=p>))</span>
</span></span><span class=line><span class=cl>        <span class=n>phase</span><span class=p>[</span><span class=n>beta_index</span><span class=p>]</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>get_phase</span><span class=p>(</span><span class=n>BETA</span><span class=p>[</span><span class=n>beta_index</span><span class=p>],</span> <span class=n>w</span><span class=o>/</span><span class=mi>100</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>plt</span><span class=o>.</span><span class=n>figure</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>plt</span><span class=o>.</span><span class=n>xlabel</span><span class=p>(</span><span class=s1>&#39;Frequency(rad/s)&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>plt</span><span class=o>.</span><span class=n>ylabel</span><span class=p>(</span><span class=s1>&#39;Gain[dB]&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>beta_index</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=nb>len</span><span class=p>(</span><span class=n>BETA</span><span class=p>)):</span>
</span></span><span class=line><span class=cl>    <span class=n>plt</span><span class=o>.</span><span class=n>plot</span><span class=p>(</span><span class=n>frequency</span><span class=p>[</span><span class=n>beta_index</span><span class=p>],</span> <span class=n>gain</span><span class=p>[</span><span class=n>beta_index</span><span class=p>],</span> <span class=n>label</span><span class=o>=</span><span class=s2>&#34;beta=&#34;</span><span class=o>+</span><span class=nb>str</span><span class=p>(</span><span class=n>BETA</span><span class=p>[</span><span class=n>beta_index</span><span class=p>]))</span>
</span></span><span class=line><span class=cl><span class=n>plt</span><span class=o>.</span><span class=n>legend</span><span class=p>(</span><span class=n>bbox_to_anchor</span><span class=o>=</span><span class=p>(</span><span class=mf>1.05</span><span class=p>,</span> <span class=mf>1.0</span><span class=p>),</span> <span class=n>loc</span><span class=o>=</span><span class=s1>&#39;upper left&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>plt</span><span class=o>.</span><span class=n>show</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>plt</span><span class=o>.</span><span class=n>figure</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>plt</span><span class=o>.</span><span class=n>xlabel</span><span class=p>(</span><span class=s1>&#39;Frequency(rad/s)&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>plt</span><span class=o>.</span><span class=n>ylabel</span><span class=p>(</span><span class=s1>&#39;Phase[deg]&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>beta_index</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=nb>len</span><span class=p>(</span><span class=n>BETA</span><span class=p>)):</span>
</span></span><span class=line><span class=cl>    <span class=n>plt</span><span class=o>.</span><span class=n>plot</span><span class=p>(</span><span class=n>frequency</span><span class=p>[</span><span class=n>beta_index</span><span class=p>],</span> <span class=n>phase</span><span class=p>[</span><span class=n>beta_index</span><span class=p>],</span> <span class=n>label</span><span class=o>=</span><span class=s2>&#34;beta=&#34;</span><span class=o>+</span><span class=nb>str</span><span class=p>(</span><span class=n>BETA</span><span class=p>[</span><span class=n>beta_index</span><span class=p>]))</span>
</span></span><span class=line><span class=cl><span class=n>plt</span><span class=o>.</span><span class=n>legend</span><span class=p>(</span><span class=n>bbox_to_anchor</span><span class=o>=</span><span class=p>(</span><span class=mf>1.05</span><span class=p>,</span> <span class=mf>1.0</span><span class=p>),</span> <span class=n>loc</span><span class=o>=</span><span class=s1>&#39;upper left&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>plt</span><span class=o>.</span><span class=n>show</span><span class=p>()</span>
</span></span></code></pre></div><h2 id=参考>参考</h2><ul><li><a href=https://www.researchgate.net/publication/331807228_Simple_Exponential_Smoothing_and_Its_Control_Parameter_A_Reassessment>Simple Exponential Smoothing and Its Control Parameter: A Reassessment</a></li></ul><div><div>Tags:</div><ul><li><a href=/tags/%E3%83%95%E3%82%A3%E3%83%AB%E3%82%BF%E3%83%AA%E3%83%B3%E3%82%B0/>フィルタリング</a></li></ul></div><nav aria-label=breadcrumb><ol class=breadcrumb><li class=breadcrumb-item><a href=/>Home</a></li><li class="breadcrumb-item active" aria-current=page>指数移動平均(Exponential Moving Averages)フィルタの周波数特性</li></ol></nav></main><footer><p style=text-align:center>Copyright 2024. All rights reserved.</p></footer></body></html>